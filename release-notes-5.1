HTML header: <title>dCache 5.1 Release Notes</title>
             <!--#include virtual="/template/default-head.shtml" -->
             <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
             <!-- Bootstrap -->
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
                   integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
                   integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous"/>
             <!--link type="text/css" rel="stylesheet" href="jquery.tocify.css" /-->
             <style type="text/css">
             h5 {
                 font-size: 15px;
                 font-style: italic;
                 margin-top: 20px;
             }
             body {
                 padding-top: 20px;
             }
             @media (max-width: 767px) {
                 #toc {
                     position: relative;
                     width: 100%;
                     margin: 0px 0px 20px 0px;
                 }
             }
             @media print {
                 #toc {
                     display: none;
                 }
             }
             </style>

<div class="container">
<div id="banner">
   <div id="bird_large">
      <img src="/images/dcache-banner.png" class="bird"></img>
   </div>
   <div id="sidebar-b">
      <span class="dcache-nav-bar">
      <a href="/index.shtml">home</a>
      |
      <a href="/news.shtml">news</a>
      |
      <a href="/manuals/index.shtml">documentation</a>
      |
      <a href="/downloads/IAgree.shtml">downloads</a>
      |
      <a href="/feedback.shtml">feedback</a>
      |
      <a href="/manuals/googlesearch.shtml">search</a>
      |
      <a href="/imprint.shtml">imprint&#160;</a>
      </span>
   </div>
</div>
<div id="content">

<div class="row">

<div class="page-header">
<h1>What's new in dCache 5.1<br/>
<small>Release notes</small></h1>
</div>

## Highlights

The 5.1 series of dCache focuses on new data transfer features.

It introduces 3rd-party copy capabilities to the xrootd protocol. 

FTP doors can now be accessed using anonymous FTP, and encrypted FTPS (TLS) authentication is now supported as well.

gPlazma has gained support for SciToken authentication as well as improved OpenID Connect support.

Pools can now send the full set of inotify events through SSE.

Pool manager can create dynamic pool groups based on defined tags.


## Incompatibilities

  * The Kafka configuration was moved from dcache.properties to a dedicated kafka.properties file.

## Acknowledgments

Once again, we are grateful for code and documentation contributions from contributors outside of our core team.

Onno Zweers provided many helpful corrections to the documentation.

Lea Morschel also provided documentation and code refinements.

Other contributions originated from a lecture at HTW Berlin; many thanks to Jonas Grabber, "tabea" and "xpinkyx" for their contributions.


## Release 5.1.0

### Admin (@paul)

### Alarms

So that they can be given different priority levels, a new alarm, ``POOL_DEAD``, was created to distinguish a pool
which is completely unreachable, from ``POOL_DOWN`` or ``POOL_DISABLED``.

Alarms was also modified in order to be able to support a more modern version of the logback library.

### Billing

The database connection was wrapped so as to catch fatal exceptions and report them as alarms (this
is already done for other databases such as chimera).

When using the Kafka messaging system, the "billing" topic was hardcoded until now. This release introduces
a new configuration variable, `dcache.kafka.topic=billing` to configure this. 

### Frontend

A bug preventing the proper filtering of active transfers according to uid was fixed.  A reminder as
to how this works:  (a) admins always see everything; (b) authenticated users always see their own
transfers; (c) if ``frontend.authz.unlimited-operation-visibility`` is set to `true`, authenticated users
can see all transfers.  Non-authenticated users can only see anonymous transfers.

### FTP (@paul)

### gplazma (@paul)

### History (@marina)

### httpd (@marina)

### Info (@marina)

### Missing Files (@femi)

### NFS (@tigran)

### PNFS Manager (@femi)

### Pool (@femi)

### Pool Manager 

Added option `-dynamic` to `psu create pool` command to create a pool group that will dynamically add all pools
that have a specific attribute. Currently, only pool tag, defined by `pool.tags` property is supported.

Example:
```
>  psu create pgroup -dynamic -tags=zone=A zone-A-pools
```

Will create pool group `zone-A-pools` and any existing pool as well as any new pool that configured with tag
`zone=A` will be automatically included into that pool group.

### Resilience

An important bug (from a race condition) which made resilience susceptible to causing data loss during removal of excess replicas
was fixed.

Several smaller bug fixes were also applied:

1) The restart command

```
\s Resilience pool ctrl start
```

now properly reinitializes the pool state on the pool operations.

2) The retry command

```
\s Resilience retry errors
```

no longer throws a string index exception.

3.  After excluding a pool, it cannot be scanned under any circumstances; it must be explicitly included
again before scanning can be activated on it; i.e.,

```
\s Resilience pool include [pool expression]
```

Logging of messages has also been added to resilience in order to be able to trace its communication with
other dCache components.  These records appear at INFO level in the ``resilience.resilience`` log.

For clarity, the final state of a file operation which ends up being unnecessary is no longer reported
as 'VOID', but as 'NOOP', when you do:

```
\s Resilience file ls
```

### SRM / SRM Manager (@sibel)

### Statistics (@sibel)

### Transfer Manager (@vingar)

### WebDAV (@vingar)

### XRootD

The dCache xrootd door/server now supports security level configuration and signed hash verification. See
``dcache.properties`` under "Xrootd: support for verifying signed hashes (by server/door)" for information.

We have also added support for mapping clients with valid credentials to NOBODY; this also enables the
current version of third-party-copy (which lacks the full proxy delegation that will be available in
the next Golden Release [5.2]) to allow destination servers to log in anonymously to dCache as source
during third-party-copy; in this latter case (only), dCache also allows the server to see read-protected files.

A bug involving access logging when the door is configured with HAproxy was fixed, and trace-level logging
in general was converted to debug-level, so that the former may be reserved for handshake packet dumps only.

### Zookeeper (@vingar)

### Changes affecting multiple services

Kafka topics can now be set independently for several services using the variables 

    dcache.kafka.topic = billing

(where "billing" is the default value) and the more specific

    dcap.kafka.topic = ${dcache.kafka.topic}
    ftp.kafka.topic = ${dcache.kafka.topic}
    nfs.kafka.topic = ${dcache.kafka.topic}
    pool.kafka.topic = ${dcache.kafka.topic}
    webdav.kafka.topic = ${dcache.kafka.topic}
    xrootd.kafka.topic = ${dcache.kafka.topic}

### Changelog from 5.0.0 to 5.1.0

<!-- git log 5.0..5.1 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

(tbd as soon as the branching is done.
In order to run the git log command given above, make sure that
- both branches are checked out and "git pull"ed in to make them local on your machine and
- you replace the single dashes by double dashes on the command's parameters)

</div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
        integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>


