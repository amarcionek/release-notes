HTML header: <title>dCache 5.0 Release Notes</title>
             <!--#include virtual="/template/default-head.shtml" -->
             <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
             <!-- Bootstrap -->
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
                   integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
                   integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous"/>
             <!--link type="text/css" rel="stylesheet" href="jquery.tocify.css" /-->
             <style type="text/css">
             h5 {
                 font-size: 15px;
                 font-style: italic;
                 margin-top: 20px;
             }
             body {
                 padding-top: 20px;
             }
             @media (max-width: 767px) {
                 #toc {
                     position: relative;
                     width: 100%;
                     margin: 0px 0px 20px 0px;
                 }
             }
             @media print {
                 #toc {
                     display: none;
                 }
             }
             </style>

<div class="container">
<div id="banner">
   <div id="bird_large">
      <img src="/images/dcache-banner.png" class="bird"></img>
   </div>
   <div id="sidebar-b">
      <span class="dcache-nav-bar">
      <a href="/index.shtml">home</a>
      |
      <a href="/news.shtml">news</a>
      |
      <a href="/manuals/index.shtml">documentation</a>
      |
      <a href="/downloads/IAgree.shtml">downloads</a>
      |
      <a href="/feedback.shtml">feedback</a>
      |
      <a href="/manuals/googlesearch.shtml">search</a>
      |
      <a href="/imprint.shtml">imprint&#160;</a>
      </span>
   </div>
</div>
<div id="content">

<div class="row">

<div class="page-header">
<h1>What's new in dCache 4.2<br/>
<small>Release notes</small></h1>
</div>

## Highlights
 - Java11 support 
 - pinboard includes date and time
 - updated external dependencies

## Incompatibilities
This release breaks compatibility with pools running dcache version 2.16 or earlier.

## Acknowledgments
We thank HTW-Berlin students Marcel Munce, Ferdinand Wolff and MaKrHTW (???) as well
as Onno Zweers from surfSARA for their contributions.

## Release 5.0.0

### Admin

A new property in the frontend `frontend.authz.unlimited-operation-visibility` 
now controls visibility of operations exposing file metadata. The default is `false`, meaning 
non-admin users can only see file operations for files which they own or which are 
anonymous. Setting it to `true` allows everyone access.
([267d937c79](https://github.com/dCache/dcache/commit/267d937c79713330ae2161dd28b05ee4166d2934)).

Monitoring information exposed through 
the HTTP GET method is now available  to all users and not only admin role users.
([32597dc77a](https://github.com/dCache/dcache/commit/32597dc77aeca34144a374e75ffe23e6b3b69a36)).

The admin data fields like the lists of pools, groups, units, etc., are now
sorted by default for the admin REST API.
([4928eff71d](https://github.com/dCache/dcache/commit/4928eff71dabcc66deb3ad35a3a652ce9e1f943c)).
 
The dCache admin ssh server now supports kerberos authentication mechanism and
abilty to enable desired set of authentication mechanism(s). The following
variables are added to configure admin ssh server authentication:

```
Supported ssh authentication mechanisms : kerberos, password, publickey
```

```
(any-of?kerberos|password|publickey)admin.ssh.authn.enabled = password,publickey
```
Location of keytab file which is needed when kerberos authentication
mechanism is enabled

```
admin.ssh.authn.kerberos.keytab-file = /etc/krb5.keytab
```
([cbab40a841](https://github.com/dCache/dcache/commit/cbab40a8415e81d96dfd775a0d28f3f9158d2eaf)).

### Alarms

A bug impeding reception of email alarms when the XML database is used has been fixed.

### Billing

### Cleaner

### DCAP

### Frontend

### FTP

Bug which have been fixed:

The leaking server sockets issue , when a client aborts a proxied transfers with kafka ebnabled  is now fixed. No further server sockets leaked when a proxy is being used, Kafka
notification is enabled, and the client aborts the transfer.

Improved features:  Improve `date` value formatting when sending billing events via Kafka. 

### gplazma

The credential information (e.g., distinguished name) is now logged for x509 certification chain validation and FQAN extraction failures.
([9c39e149e0](https://github.com/dCache/dcache/commit/9c39e149e0db31a088d46ebd602fe5fd63c20eb9)).

Large numerical value gids may be used to define roles fro groupid (gid).
([11b34011ae](https://github.com/dCache/dcache/commit/11b34011ae9c613db6aae0ca8a822853d2cf7e2a)).
 
Wildcard match of FQANS is possible for the VO group (`vo-group.json`) gplazma plugin.
[173dca3a96](https://github.com/dCache/dcache/commit/173dca3a96d52acca73bac1c9ea568338095037f)).  

A new role, "observer", is defined and available for according read-only access to system or file information.
([4aa440ab2a](https://github.com/dCache/dcache/commit/4aa440ab2abd46cd1903384d2c47ecec0677eb98)).  

The Storage AuthzDB file format is updated to accept an optional
'max-upload=<value>' element after the 'read-write' or 'read-only'
value.  The label is optional.  If present, the value describes the
maximum file size the user can upload.
([e3dce67083](https://github.com/dCache/dcache/commit/e3dce67083166451be67c42700640eaed2597669))

As some newer authentication mechanisms embed usage limitations; i.e., a
user may authenticate in a way that limits what that user can do (E.g. SciTokens)
New authentication plugins have the possibility to specify a Restriction
as part of the authentication process.  Existing authentication plugins
are supported as before. ([204024b9e8](https://github.com/dCache/dcache/commit/204024b9e878b85fbd6a5583908ccada4396d944)).  


A new configuration option has been introduced to capture all
information about an OpenID-Connect provider, which is  
some external service that dCache users can authenticate against.

This configuration property is a map.  Each entry of the map
associates a nickname with information about that provider.  The
nickname is used when logging problems with the provider.  The
information is the URI of the issuer endpoint.  This must be a
valid URL that starts 'https://'.

The following example associates the nickname 'google' with 
Google's issuer endpoint.

```
      gplazma.oidc.provider!google = https://accounts.google.com/
````
([bab4e635ac](https://github.com/dCache/dcache/commit/bab4e635ac1b451b772badc70c9b89da6892ac65)). 
 
### History

### Hoppingmanager

### httpd

### Info

### Missing Files

### NFS

When pNFS client uses flex_file layout IO errors with pool (data server) are reported to NFS door. The erros can be interpreted
as:
```
  NFS4ERR_NXIO:  The client was unable to establish any communication
      with the storage device.

   NFS4ERR_*:  The client was able to establish communication with the
      storage device and is returning one of the allowed error codes.
```
### Pinmanager

### PNFS Manager

### Pool

Fixed pool repository space accounting leak on failed restores from tape
([815ce3eb6a](https://github.com/dCache/dcache/commit/815ce3eb6a7898152d38abd97590336d434545c7)).
Added Cross-Origin Resource Sharing (CORS) support for HTTP requests ([049c87a814](https://github.com/dCache/dcache/commit/049c87a8141e3dad7f42f2a2497f01c5db080da9)) required by dCacheView.
Fixed HTTPS redirected transfers by returning pool canonical hostname in the redirected URLs.
([7f81b8e79d](https://github.com/dCache/dcache/commit/7f81b8e79de9de53545b23ef4fd93448bb17eb3c)).
Fixed stopwath error to ensure that IO-statistics collecting is more robust,
 avoiding stack-traces with the message 'This stopwatch is already stopped' ([86ede8a240](https://github.com/dCache/dcache/commit/86ede8a2403598d9b9383e7ebb2a120a3eed7aeb)).
Better handling of HTTP 3-rd party transfers -  improved logging of exceptions
([a98d667c16](https://github.com/dCache/dcache/commit/a98d667c16b2dbff774d0ca91d741de80bb02d9c)),
increased socket timeout for GET requests ([845cfe0bda](https://github.com/dCache/dcache/commit/845cfe0bdaff4b22a1402bfa0452a1b7ef3f6d2c)). Improved error logging in billing by using exception calss name if exception has `null` message ([24de520285](https://github.com/dCache/dcache/commit/24de52028527563309728bb9fa56504d7f75bed7)).
Removed stack-trace logging of checked exceptions on P2P failures ([7a570355fa](https://github.com/dCache/dcache/commit/7a570355fade688b01bfbad6549c3e6fea49bf01)). Fixed pool runtime configured size regression ([f5ba0103ea](https://github.com/dCache/dcache/commit/f5ba0103ea1b6b91b22e6c17b203fa9913ec5251)).
Updated HTTP 3-rd party copy to support retrying GET and HEAD requests for better ineroperability with
DPM ([d0a621c775](https://github.com/dCache/dcache/commit/d0a621c77520df548b5d73155b1a0450a693bcf2)).
 Updated FTP mover to log additional information if it detects partial transfers ([e725f7b9e7](https://github.com/dCache/dcache/commit/e725f7b9e7fa86188afce578d26d4a141c69d297)). Dropped subject from StorageInfoMessage
([0e60cdcaaa](https://github.com/dCache/dcache/commit/0e60cdcaaa96e2ca88fa116e6203b32feb10e0cf)). Fixed regression when restoring files from tape ([7cdcf4e0a7](https://github.com/dCache/dcache/commit/7cdcf4e0a7a447d75d7c77e5fceafb56c2c76a4f)). Fixed NullPointerException on flush when using Kafka to collect billing records
([4e396b9234](https://github.com/dCache/dcache/commit/4e396b92346da9f4a08c78a47e956a7ded05e3f9)). Fixed
protocol movers to handle out of disk/out of capacity eerrors.

Eliminated stack trace generated by bad input for the following admin commands:
```
  queue activate
  queue activate class
  queue remove class
  queue suspend class
  queue resume class
  queue remove pnfsid
```
([0faa607806](https://github.com/dCache/dcache/commit/0faa607806249bba1212629e6eff6f9bca276d7f)).

Added support for Content-MD5 request header ([4d954e6b5f](https://github.com/dCache/dcache/commit/4d954e6b5f5b92f626a40de672293790c9e0c589)).

Updated HTTP mover to report errors as HTTP status message phrase so that
clients that log the status line now provide their users with more
    detailed information about what caused a transfer to fail ([6fcaeca34c](https://github.com/dCache/dcache/commit/6fcaeca34cb45087577889737b081a2b58cb2983)).

Fixed regression that broke `dcache pool convert' command ([80461b2f9a](https://github.com/dCache/dcache/commit/80461b2f9ad3f881b228b6ce8c3a0857556d9220)) and `dcache pool convert` command ([80461b2f9a](https://github.com/dCache/dcache/commit/011b3b243972c574f6002062684f0b4cc432a43f)).

Introduced a retry loop to retry file attributes update in timeout to pnfs manager ([8c60877527]((https://github.com/dCache/dcache/commit/8c60877527869095acf23dd95f424d1df1e5b790).

### Poolmanager

### Resilience

Bugs which have been fixed:  (1) an error is no longer reported when trying to handle a broken file which has
already been unlinked; (2) the entire pool scan no longer fails when one file in the list is not resilient
or has no locations; (3) filters referencing invalid pool names no longer cause scan cancel to fail.

Improved features:  (1) command ``retry errors`` immediately reprocesses the most recent failed file operations;
(2) the command ``pool ls`` now displays the number of file operation errors encountered during a given scan;
(3) the list of pools is now sorted by STATE (RUNNING, WAITING, IDLE) and then by pool name in ascending
lexicographic order; (4) the ``inaccessible`` command now has options to check the status of the job,
to display the current contents of the 'inaccessible list' file for that pool, and to clean up/delete that file;
(5) 'referring pool' has been added to the inaccessible alarm to enable grep'ing the resilience log for
a given scanned pool.

### Space Manager

### SRM / SRM Manager

Fixes in gridsite delegation storage handling - fixed querying validity of delegated credential stored on the gridsite end-point
 allowing clients like  `davix-cp` to work ([839604e45f](https://github.com/dCache/dcache/commit/839604e45f5af327e6547a7fce80a828089eb6c5)) with dCache;
fixed handling of delegated credential with VOMS AC
that expires before the X.509 ([54658383d1](https://github.com/dCache/dcache/commit/54658383d15303eecb7728ca0bbfa1f89a63d960)); imporved error reporting ([41976be12d](https://github.com/dCache/dcache/commit/41976be12d6788a28c3cab5bdcec66763d0c9c23)); added add gridsite delegation interface access-log ([5392271fcf](https://github.com/dCache/dcache/commit/5392271fcffb2bd6f09a1b74a52051f2e26e91e8)).

SRM client has been updated to support `X509_CERT_DIR` environmental variable ([ed8b86e604](https://github.com/dCache/dcache/commit/ed8b86e60422b82456d0e2f4fcf9277da68bb716)).

Fixed handling of duplicate SURLs by SRM client ([36b9e0c7d6](https://github.com/dCache/dcache/commit/36b9e0c7d68f2c4eade1875d8d0ec1f1a770c454)).

### Statistics

### Topo

### Transfer Managers

### WebDAV

### XRootD

Third-party copy was introduced in 4.2, and continues to be improved.  For further information on configuration,
please refer to the documentation in _The Book_ (5.0).

Bug fixes and improvements:  (1) the correct error (kXR_NoSpace) is now returned to the client when there is no more disk space;
(2) xrootd now fails fast if the MaxUploadSize is supplied, and the file is too large; (3) the xrootd door spring configuration
no longer fails to load when kafka is not activated; (4) the 'stat' request now supports both open file handles as well
as paths, enabling use of the ``--zip`` option; (5) dCache no longer logs a  stack trace when a client requests a file be
created, the parent directory does not exist, and the make parent option is omitted; (6) a source path containing
a query part on a mv request no longer causes the request to fail; (7) a potential race condition preventing directory
listing now is correctly handled; (8) support for the 'tpc' query on the pools has been added in order to comply with
the newer (4.9) XrootD clients; (9) it is now no longer necessary nor correct to list 'access-log' among the xrootd plugins;
this log handler is added automatically as it is for other doors; (10) file handles and query strings are now included in
the access log information; (11) logging of failed authentication is improved to include more useful information, like
the DN; (12) it is now possible to identify all entries in the access-log from the same TCP connection via a session identifier.

### Zookeeper


### Changelog from 4.2.0 to 5.0.0

<!-- git log 4.2..5.0 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

(tbd as soon as the branching is done.
In order to run the git log command given above, make sure that
- both branches are checked out and "git pull"ed in to make them local on your machine and
- replace the single dashes by double dashes on the command's parameters)



</div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
        integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
