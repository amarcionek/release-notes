HTML header: <title>dCache 4.2 Release Notes</title>
             <!--#include virtual="/template/default-head.shtml" -->
             <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
             <!-- Bootstrap -->
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
                   integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
             <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
                   integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous"/>
             <!--link type="text/css" rel="stylesheet" href="jquery.tocify.css" /-->
             <style type="text/css">
             h5 {
                 font-size: 15px;
                 font-style: italic;
                 margin-top: 20px;
             }
             body {
                 padding-top: 20px;
             }
             @media (max-width: 767px) {
                 #toc {
                     position: relative;
                     width: 100%;
                     margin: 0px 0px 20px 0px;
                 }
             }
             @media print {
                 #toc {
                     display: none;
                 }
             }
             </style>

<div class="container">
<div id="banner">
   <div id="bird_large">
      <img src="/images/dcache-banner.png" class="bird"></img>
   </div>
   <div id="sidebar-b">
      <span class="dcache-nav-bar">
      <a href="/index.shtml">home</a>
      |
      <a href="/news.shtml">news</a>
      |
      <a href="/manuals/index.shtml">documentation</a>
      |
      <a href="/downloads/IAgree.shtml">downloads</a>
      |
      <a href="/feedback.shtml">feedback</a>
      |
      <a href="/manuals/googlesearch.shtml">search</a>
      |
      <a href="/imprint.shtml">imprint&#160;</a>
      </span>
   </div>
</div>
<div id="content">

<div class="row">

<div class="page-header">
<h1>What's new in dCache 4.2<br/>
<small>Release notes</small></h1>
</div>

## Highlights

This release ships with dCache-View 1.4+ which provides a new version of the
familiar admin pages.  Currently, access to these new pages requires the user
to be authorized (and to assert) the admin role.  The pages are only fully
populated with their respective data when, in addition to the frontend service,
the alarms and history services are running, and the billing service has
the database backend enabled.

With this release, dCache-View completely replaces the (Wicket-based) “webadmin”
interface, which is no longer available on ports 2288 and 8440.  (The
old static pages at http://&lt;host>:2288/old are, on the other hand, still available,
but these, too, will eventually be removed in a future release.)

## Incompatibilities

Some changes
([a11ec8d76b](https://github.com/dCache/dcache/commit/a11ec8d76b549e3e1de948e2848d73d86725029e),
[887d8d5738](https://github.com/dCache/dcache/commit/887d8d5738c6e2c554af8cd14e9ff8028b5e0573) and
[2ff49b600c](https://github.com/dCache/dcache/commit/2ff49b600c5f7e24148596a8a70f26af0bdd12ea)
) in the current release require that Pool Manager, Space Manager and Door
instances must be updated to 4.2 at the same time. For users that wish to do incremental
updates, pools may remain at 4.1 during that update.

## Acknowledgments

The dCache team thanks Christoph Anton Mitterer, Martin Johnki, Onno Zweers and Johannes Thurn
for their pull requests and contributions.

## Release 4.2.46

### pool

Pool health-check log messages now include the pool's name.

### webdav

On an unsuccessful HTTP-TPC pull request, dCache will delete the file.
If  this deletion did not work then an error was  logged. This is fixed now and 
failures to delete the incomplete file from a failed HTTP-TPC pull
request, where the incomplete file has been deleted by some other means
are now logged at DEBUG level, rather than WARN level.

### xrootd

The current release refited checksum handling after xrootd4j bug fix. 


### Changelog 4.2.45..4.2.46

<!-- git log 4.2.45..4.2.46 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[9cc8d6d](https://github.com/dcache/dcache/commit/9cc8d6d154cb73f97988e2f8b56f2dad37f5f422)
:   [maven-release-plugin] prepare release 4.2.46

[a92589d](https://github.com/dcache/dcache/commit/a92589d2c70521280d0c063f38ca77bf85079700)
:   dcache-xrootd: refit checksum handling after xrootd4j bug fix

[5349dd5](https://github.com/dcache/dcache/commit/5349dd5249ee4c52dc9d116b5170252b8e68a3de)
:   webdav: avoid logging non-error as an error

[c1cb9fd](https://github.com/dcache/dcache/commit/c1cb9fda1db336a942606582f5fdb7196564e438)
:   pool: include pool name in health-check reports

[3488666](https://github.com/dcache/dcache/commit/3488666bc59798ef03317a89bba2fb662a6ddc04)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.45

### frontend

The current release fixed QoS pin semantics.

A bug is fixed in frontend that results in a NullPointerException for
billing queries where no limit is specified.


### Changelog 4.2.44..4.2.45

<!-- git log 4.2.44..4.2.45 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[5fe7649](https://github.com/dcache/dcache/commit/5fe76491dfc9d969b5643324c5828e94be40bcb0)
:   [maven-release-plugin] prepare release 4.2.45

[95694d9](https://github.com/dcache/dcache/commit/95694d91abec4fe7f9071c70dd30210c28b9c679)
:   frontend: fix NPE if limit is not specified

[34ca0ec](https://github.com/dcache/dcache/commit/34ca0ec10ba5e8ce0dcc1d67e472690faff05426)
:   dcache-frontend: fix QoS pin semantics

[fca79f8](https://github.com/dcache/dcache/commit/fca79f87da0df9097f93efe3bb4aaf53f13a6ace)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.44

### Changes affecting multiple services

The Apache Commons Compress library used in dCache was updated to version 1.19.

A rare deadlock situation in the Chimera database was eliminated. In cases
where, within the same directory, concurrent mkdir and rmdir events happened,
transactions within the database could deadlock. This would be indicated by the message

    ERROR: deadlock detected

in the logs.

### pool

There were reports of extraordinarily high CPU usage on pool nodes with a large
number of cached files. Through an optimization of the `sweeper`, CPU usage
was reduced significantly.

### xrootd

This release fixes a vulnerability in dCache's XRootD protocol implementation. 
We recommend that all sites update their XRootD doors.
Details will be made available through EGI Security and, in a week's time, through an
update to these release notes.


### Changelog 4.2.43..4.2.44

<!-- git log 4.2.43..4.2.44 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[7bfe8eefac](https://github.com/dcache/dcache/commit/7bfe8eefac9bae268475ba65c5fe719dcae5d964)
:   [maven-release-plugin] prepare release 4.2.44

[fb6913af6d](https://github.com/dcache/dcache/commit/fb6913af6d9023ae8e96b6eb8a06409f092db749)
:   dcache-xrootd: honor read paths when listing directories

[246a96209f](https://github.com/dcache/dcache/commit/246a96209fd32bd8d50fe7ae74c240e16086c928)
:   resilience: don't compare Integer objects by refference

[4fd1250396](https://github.com/dcache/dcache/commit/4fd1250396acb58506db215622bd280a32b349c0)
:   sweeper: use in-memory map instead of repository for histogram data

[c59972f06b](https://github.com/dcache/dcache/commit/c59972f06b75d926f8baf3c6118c60c1f531fe92)
:   dcache-xrootd: replace constants for version number

[cc59b68f91](https://github.com/dcache/dcache/commit/cc59b68f911cfb633def19b2f535557288bd0da5)
:   dcache-xrootd: update protocol version numbers

[73f75af9b4](https://github.com/dcache/dcache/commit/73f75af9b4ce0c429c6ecd6e155a64f23db6aab5)
:   libs: update apache.commons:commons-compress to 1.19

[ab0e78e949](https://github.com/dcache/dcache/commit/ab0e78e9498c4fef8ba09723c90684786159d1c4)
:   chimera: fix ABBA db deadlock when mkdir and rmdir run concurrently

[5b12d34f43](https://github.com/dcache/dcache/commit/5b12d34f43f920b74bf883374102f28d266c8acd)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.43

### dcap

dcap door could not  handle out-of-date errors. This is now fixed.

### gplazma

The current release fixed  thread leak by explicitly close NamingEnumeration

### httpd

The current release fixed  escape status field in HttpPoolMgrEngineV3.


### Changelog 4.2.42..4.2.43

<!-- git log 4.2.42..4.2.43 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[16fbcfe](https://github.com/dcache/dcache/commit/16fbcfead23c34947d5d960aea3668592a31b1ed)
:   [maven-release-plugin] prepare release 4.2.43

[2807958](https://github.com/dcache/dcache/commit/280795800594ba7f4762a35188d875eacf3b6e9d)
:   dcap: restart pool selection on OUT-OF-DATE error

[ea7a0cf](https://github.com/dcache/dcache/commit/ea7a0cfdb5a6e2eef2e90bf9d9b1c10656297e24)
:   gplazma-ldap: avoid thread leak by explicitly close NamingEnumeration

[e8c88f7](https://github.com/dcache/dcache/commit/e8c88f7dd7859f6962242e69110e9d790e6c6528)
:   httpd: escape status field in HttpPoolMgrEngineV3

[291213c](https://github.com/dcache/dcache/commit/291213c9986177dc34f472daaaaf0e32a53d89bb)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.42

### srm

A new user community requires the srm tools to be able to handle
very large file listings. During preliminary tests, OutOfMemory
errors from the srmls tool were observed. This is now fixed and 
srm can now support operations on very large file lists
without running out of memory.

### webdav

The current release added allow header to list of response headers for OPTION method
request.


### Changelog 4.2.41..4.2.42

<!-- git log 4.2.41..4.2.42 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[f610c7f](https://github.com/dcache/dcache/commit/f610c7fd95c6bb251090104c6aa3deb723ece26f)
:   [maven-release-plugin] prepare release 4.2.42

[1f7bac2](https://github.com/dcache/dcache/commit/1f7bac201434fc4202fc500ec8c5b55078bc7514)
:   webdav: add allow header to OPTION method request

[f2bd61c](https://github.com/dcache/dcache/commit/f2bd61c3aafa6950c928665f40b822088804a0c5)
:   srm: Remove JVM memory limits

[36fc58d](https://github.com/dcache/dcache/commit/36fc58d1987165fa70df68b840739d09305c31e2)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.41

### common

The current release fixed formatting of error message in Checksum. 

### frontend

Admins may now configure frontend to specify in which country (or
countries) data may be stored. This information is visible through
dCacheView.


### Changelog 4.2.40..4.2.41

<!-- git log 4.2.40..4.2.41 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[e9ee03b](https://github.com/dcache/dcache/commit/e9ee03b59c3c550cca31bf089c403c5f49225720)
:   [maven-release-plugin] prepare release 4.2.41

[4a4bc96](https://github.com/dcache/dcache/commit/4a4bc96ed77beac0159ec2ce19b36a93e5cd1a1d)
:   frontend: make geographic placement configurable

[0eb4352](https://github.com/dcache/dcache/commit/0eb435225785cef693335db55df8e6fb51a7a368)
:   common: fix formatting of error message in Checksum

[a0af8d7](https://github.com/dcache/dcache/commit/a0af8d7c9666afbc340472883fa3034ae5623d0f)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.40

### nfs

NPE on "show transfers" command is now fixed.

### webdav

The current release fixed CORS for WebDAV doors that do not allow anonymous
access; in particular, to support dCacheView uploading
and downloading files with such authentication-required
WebDAV doors.


### Changelog 4.2.39..4.2.40

<!-- git log 4.2.39..4.2.40 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[10130fe](https://github.com/dcache/dcache/commit/10130fefc7393f2292c14c542089a7cca4249446)
:   [maven-release-plugin] prepare release 4.2.40

[9f23dc0](https://github.com/dcache/dcache/commit/9f23dc06a88535cf9e27792b5dd3955d6afc4902)
:   nfs: fix NPE on "show transfers" command

[65db4f8](https://github.com/dcache/dcache/commit/65db4f8b88031183cd294b6dab38ecf1bc96f0c6)
:   webdav: fix cross origin resources sharing issue

[11ec1a7b](https://github.com/dcache/dcache/commit/11ec1a7bee59c44804dcbf7e22f942b9032dd564)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.39

### chimera

The shell infrastructure supports commands being given interactively, on
the commandline (e.g., 'chimera mkdir /path/to/dir') and from stdin
(e.g., 'echo "mkdir /path/to/dir" | chimera'). `chimera` now supports the latter
case and properly shows command output when invoked in that fashion. 

### frontend

This release updates dCache View to 1.5.5.

### webdav

A client may issue a PUT request that targets an existing collection
resource; i.e., attempt to write a file as a path that is a directory.
dCache, until now, responded with an incorrect status code of 500. This release
changes the status code for this operation to 405 (Method not allowed), 
thus keeping closer to RFC 4918.

### xrootd

This release improves compatibility with the xrdcp client in versions \>4.9
by responding correctly to query strings requesting a specific checksum type.


### Changelog 4.2.38..4.2.39

<!-- git log 4.2.38..4.2.39 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[2e397312d8](https://github.com/dcache/dcache/commit/2e397312d875ed3fdfbaf62a9c1680aa85f59d69)
:   [maven-release-plugin] prepare release 4.2.39

[75f6f709c9](https://github.com/dcache/dcache/commit/75f6f709c92ce6bb37d73143f1b44a5dec9019ae)
:   dcache, frontend: release dcache-view version 1.5.5

[e9e8116ca9](https://github.com/dcache/dcache/commit/e9e8116ca926ac08863598c4ac0fc325578461f5)
:   chimera: chimera shell should show output when commands come from stdin.

[71d073c448](https://github.com/dcache/dcache/commit/71d073c448dc09d6f7ceb7d8fcec70431fc48610)
:   webdav: return 405 status code for PUT requests targeting collections

[486ed07a35](https://github.com/dcache/dcache/commit/486ed07a3541cad721a0b8450fb0c4ec4a49f50f)
:   dcache-xrootd: add checksum cgi handling to door query

[d9e11ce6f7](https://github.com/dcache/dcache/commit/d9e11ce6f7d3fd613fbb2bd5112ea9f99b77ef27)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.38

### many

The `dcache pool ls` command now provides correct output even if the pool is
defined with a single-digit number of bytes. 


### Changelog 4.2.37..4.2.38

<!-- git log 4.2.37..4.2.38 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[370c33dffe](https://github.com/dcache/dcache/commit/370c33dffef41d607fa7dc13660f88f04c52c0e6)
:   [maven-release-plugin] prepare release 4.2.38

[88e0c7a3d8](https://github.com/dcache/dcache/commit/88e0c7a3d871c94ec30259ef0c1145405722bae2)
:   scripts: avoid copy-n-paste error when calculating pool size

[df2b7a31ce](https://github.com/dcache/dcache/commit/df2b7a31ce0358de61fb1ca8b4ddca5c7c9bcf76)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.37

### frontend

This release updates the dCache View web GUI to version 1.5.4.

### ftp

HAProxy can probe endpoints to discover if
they are still alive.

The FTP door has an optimisation that detects such probes and does not
create the FTP command interpreter, since the FTP client (the HA-Proxy
instance) is calling on behalf of itself, and will not issue any FTP
requests.

This release fixes a regression that would cause erroneous 
NullPointerExceptions when FTP doors were probed by HAProxy.

### pool

The default value for the xrootd Third-Party Copying server response timeout,
`pool.mover.xrootd.tpc-server-response-timeout`, was increased from 2 to 30 seconds 
to provide more robust behaviour in the face of high loads and network congestion.

### transfermanager

Error messages like the WebDAV door's

`Failed to fetch information for progress marker: failed to query pool: (0) Job not found : Job-1`

where the TransferManager is unable to discover the
current status of the pool mover now include the pool's name,
which should make debugging easier.


### Changelog 4.2.36..4.2.37

<!-- git log 4.2.36..4.2.37 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[0db06e6a83](https://github.com/dcache/dcache/commit/0db06e6a83a2d66bd7a2fae593f24be7f8f00ddf)
:   [maven-release-plugin] prepare release 4.2.37

[2a7152f117](https://github.com/dcache/dcache/commit/2a7152f1172b2f82ad0cbaf1dbc833330c40a124)
:   dcache, frontend: release dcache-view version 1.5.4

[953613f359](https://github.com/dcache/dcache/commit/953613f35995293ee651c0983aa65072aa561834)
:   pools: make the xrootd tpc response timeout less aggressive

[4ddcc839f9](https://github.com/dcache/dcache/commit/4ddcc839f967b0275b717d32e64ecbc585f880c7)
:   transfermanager: include pool name in error for 'mover ls' failures

[0f51166f6e](https://github.com/dcache/dcache/commit/0f51166f6e2e73eec98ba6058ccc013b3e4f729d)
:   ftp: avoid NPE on HA-Proxy probes

[3926c2e26f](https://github.com/dcache/dcache/commit/3926c2e26f507fffdfdb40c95f46ef121a5bb75a)
:   [maven-release-plugin] prepare for next development iteration

[de6d4fa3c9](https://github.com/dcache/dcache/commit/de6d4fa3c9d00e9176ea2ca359daba9c2c227d61)
:   core: fix pool selection in killAll command of TransferManager

[26cb9c29e2](https://github.com/dcache/dcache/commit/26cb9c29e2f268b1065f241a8c6714e5eb3ed979)
:   libs: update aspectj to java11 friendly version 1.9.2

[f5269d51cf](https://github.com/dcache/dcache/commit/f5269d51cf2836a1dba8cafa912fe53f2ed8eb55)
:   zookeeper: remove ZooKeeperConnectionExceptionAspect

## Release 4.2.36

### Changes affecting multiple services

This release includes an updated Jetty library, with the update adressing
CVE-2019-10247.

This release includes an updated Jetty library, with the update adressing
CVE-2019-10247.

### dcap

The Kafka messaging implementation in the dcap service has been made more robust,
fixing issue [#4831](https://github.com/dCache/dcache/issues/4831).

### frontend

Periodic activity associated with the frontend door is now logged with the
door's cell name. Such messages will also appear in the door's
pinboard.

### nfs

Periodic activity associated with the NFS door is now logged with the
door's cell name. Such messages will also appear in the door's
pinboard.

### pool

Attempting to start a full checksum scan (with `csm check *`) while an
existing scan is still running is no longer reported as a bug.

Pool start-up logging now includes the corresponding pool cell name.

An internal timing check was updated, which should result in more robust pool
behaviour. There should be no user-visible impact.

### webdav

Periodic activity associated with the WebDAV door is now logged with the
door's cell name. Such messages will also appear in the door's
pinboard.

### xrootd

A new configuration property, `pool.mover.xrootd.tpc-server-response-timeout`, allows
setting a timeout for xrootd 3rd party copy operations. This can also be changed through
the new admin command `xrootd set server response timeout`.


### Changelog 4.2.35..4.2.36

<!-- git log 4.2.35..4.2.36 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[81b97a7e0b](https://github.com/dcache/dcache/commit/81b97a7e0bc88bff0630a77a428134bcc31a27c5)
:   [maven-release-plugin] prepare release 4.2.36

[04c8ada79e](https://github.com/dcache/dcache/commit/04c8ada79e8806aee7079bc5e961c2554ab8d26c)
:   pool: avoid IllegalStateException in 'csm check *' command

[dfe3670ee9](https://github.com/dcache/dcache/commit/dfe3670ee96a7c6593c87faafc10e9f5d6679d1d)
:   dcap: fix premature close of kafka sender

[e234b45be3](https://github.com/dcache/dcache/commit/e234b45be3b7bad3702fa66e9e5c2e3ac3095eff)
:   sweeper: compute now after the values have been fetched

[236baac111](https://github.com/dcache/dcache/commit/236baac111a445abd3ac2b44bd6a02cbd0471f20)
:   libs: use jetty 9.4.18.v20190429

[aca121207b](https://github.com/dcache/dcache/commit/aca121207bd3c332831e5a530e538456b05a216f)
:   dcache-xrootd: add ability to override default timeout for server response (TPC)

[03998dbb3e](https://github.com/dcache/dcache/commit/03998dbb3ef677953d7b6519fefc6025c8d76b77)
:   [maven-release-plugin] prepare for next development iteration

[91b1a9bf63](https://github.com/dcache/dcache/commit/91b1a9bf63e302c2e2c22096e60721568ef7f4b0)
:   frontend: include CDC in scheduled activity

[c9c77f3a3e](https://github.com/dcache/dcache/commit/c9c77f3a3e58db9007e29e215fb3f66eab51af82)
:   nfs: include CDC in scheduled activity

[62ccc626f0](https://github.com/dcache/dcache/commit/62ccc626f0f1f106154905368b7fdf474b18a293)
:   webdav: include CDC in scheduled activity

[e0f853b011](https://github.com/dcache/dcache/commit/e0f853b0116ca0a7b112ce5baf5a9f56b3d1c10f)
:   pool: ensure initialisation thread has correct CDC information

[df3fae5f4a](https://github.com/dcache/dcache/commit/df3fae5f4a59b8a8357a26085a2f4ec0282dd48a)
:   jetty: make CanlContextFactory subclass of jetty.ssl.SslContextFactory.Server

[7b40be97a6](https://github.com/dcache/dcache/commit/7b40be97a645467a161852c76200e88aa5da1243)
:   pom: use jetty 9.4.17.v20190418

## Release 4.2.34

### alarms

To ease troubleshooting, the POOL_DEAD alarm message now includes the pool name.

### pinmanager

A bug was fixed where PinManager's `bulk ls` admin command yielded a 
NullPointerException if the optional argument was omitted.

A typo prevented the error message "Remote connection failure while unpinning..." from
appearing completely and correctly in the logs. The error message string now contains
the message string of the underlying Exception, hopefully providing helpful details for 
troubleshooting.

### pool

A regression that prevented a replica's last access time from being updated was fixed.

A regression that prevented a replica's position in the LRU queue for garbage collection from being updated was fixed.

### webdav

Users asserting the "admin" role would occasionally receive 
NullPointerExceptions when trying to transfer files through 
WebDAV. This release fixes that issue.


### Changelog 4.2.33..4.2.34

<!-- git log 4.2.33..4.2.34 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[8db1a503f6](https://github.com/dcache/dcache/commit/8db1a503f6ec2dfec50b5c6ca8341782b7e4bcfa)
:   [maven-release-plugin] prepare release 4.2.34

[8cfe293334](https://github.com/dcache/dcache/commit/8cfe29333443da32aa65f6315be6bf4c260ba1d2)
:   UnpinProcessor: fix assumed typo `{)`

[5541899529](https://github.com/dcache/dcache/commit/5541899529a030893cf2fb8b21a9f0c122704bff)
:   webdav: allow transfers as user with role 'admin'

[aa9f997c88](https://github.com/dcache/dcache/commit/aa9f997c88c79bda11405eca93cd866329be17f5)
:   pinmanager: avoid NPE if no argument given for 'bulk ls' command

[5f9d5e9f49](https://github.com/dcache/dcache/commit/5f9d5e9f499879646efd86422aed802e5cbbb981)
:   alarms: add pool name to POOL_DEAD alarm

[a1131deafd](https://github.com/dcache/dcache/commit/a1131deafd3f0b921b577835662bcb62c5119aeb)
:   pool: fix reordering of removable replicas on access

[82e929b623](https://github.com/dcache/dcache/commit/82e929b62396d68c56941f94aeeba7f5a8af6d9b)
:   pool: fix storage of replica last access time

[4ae111d210](https://github.com/dcache/dcache/commit/4ae111d21076f40241df4b2b7a06cb5571ba754d)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.33

### Changes affecting multiple services

Stage request from unknown locations resulted in NPE in dcap and pinmanager services.
this is now fixed and using `dccp` to stage a file should work even if the location is unknown. '--'

### frontend

A client that disconnects and quickly reconnects could  had  triggered the following NPE, this is now fixed.

### resilience

The current release fixed  race condition on replica state and no `inaccessible file errors` occures  for a newly written file.


### Changelog 4.2.32..4.2.33

<!-- git log 4.2.32..4.2.33 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[bd37754](https://github.com/dcache/dcache/commit/bd377540eceab26b7387363e08aceb6714d0b56c)
:   [maven-release-plugin] prepare release 4.2.33

[d9be5d9](https://github.com/dcache/dcache/commit/d9be5d965517c30f4969536ddeb5e740addf11d5)
:   dcap/pinmanager: stage request for unknown location results in NPE

[35b65fe](https://github.com/dcache/dcache/commit/35b65fe860c83c4271236e085e855317d661c1ab)
:   dcap batch : fix handling of dcap.kafka.topic variable

[31c8a00](https://github.com/dcache/dcache/commit/31c8a00a7b741cfd5882e2ae3854512a52fbd87e)
:   dcache-resilience (stable branches): fix race condition on replica state

[20a82c0](https://github.com/dcache/dcache/commit/20a82c051c83cdff7d3125dab17b64018fe3d258)
:   frontend: fix race on client reconnecting

[ffd1254](https://github.com/dcache/dcache/commit/ffd12540893ceed65139fd64f2332c6d34419bab)
:   [maven-release-plugin] prepare for next development iteration

[200e2f1](https://github.com/dcache/dcache/commit/200e2f15094d4e13d7cc30de899fbc67415a76c4)
:   resilience: adjust synchronization of file operation removal from map

## Release 4.2.32

### frontend

The destroy sequence for a channel failed to obtain the Channel
monitor. This could result in concurrent changes to the Channel's
state and incomplete Channel shutdown. This is now fixed and the shutdown sequence of a channel is more robust.


### pool

An unhelpful error message "Parameter `directory` is not a directory" is
replaced with one that provides information on which directory is
missing.

The pool no longer logs configuration or deployment problems that
prevent the pool from creating a mover as if that problem was a bug.

The current release fixed certain error cases, where a pool is unable to create a mover are no
longer logged as a bug in dCache.

### transfermanager

By default, the transfermanager will retry starting the mover ten times
before giving up on the pool. If we know that a pool doesn't support
this transfer type (for whatever reason), then this makes no sense. This is now fixed and a pool that does not support a particular transfer is not immediately
retried.

The current release fixed a NPE  if transfer was cancelled.



### Changelog 4.2.31..4.2.32

<!-- git log 4.2.31..4.2.32 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[d0b7b69](https://github.com/dcache/dcache/commit/d0b7b69d3aedfde60fe4c20ece955a711efb41af)
:   [maven-release-plugin] prepare release 4.2.32

[bc59ba9](https://github.com/dcache/dcache/commit/bc59ba97e36869847beb52a3999bbd03a60670ed)
:   pool: avoid throwing a RuntimeException for non-bugs

[62be882](https://github.com/dcache/dcache/commit/62be882690e47f21aaf1765d74dcebb63050fe4d)
:   transfermanager: do not retry starting mover if transfer is not supported

[1666d8b](https://github.com/dcache/dcache/commit/1666d8baf9d00e70575b49588db97717c3459950)
:   pool: avoid log-and-throw anti-pattern

[178aeb2](https://github.com/dcache/dcache/commit/178aeb2668e8c05a868b55d09694187e0b09707b)
:   frontend: ensure client is disconnected when shutting down channel

[1964c2e](https://github.com/dcache/dcache/commit/1964c2eb7c28b765af80f111e5a8d33edc2a4a3b)
:   frontend: avoid race on cancelling channel garbage-collect task

[cf9390b](https://github.com/dcache/dcache/commit/cf9390b07251c08a86b0fb2bb960170f80cd15f3)
:   transfermanager: avoid NPE on shutdown

[ac4019f](https://github.com/dcache/dcache/commit/ac4019f04bd5ed41c8cef2e97a08d0e2070ae755)
:   pool: throw exception with meaningful error message

[4ef86a4](https://github.com/dcache/dcache/commit/4ef86a4c25f91265f62f5127b861b60604b253cf)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.31

### pool

The current release improved time formatting for Json mover info.


### Changelog 4.2.30..4.2.31

<!-- git log 4.2.30..4.2.31 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[6cdf4bf](https://github.com/dcache/dcache/commit/6cdf4bfff05995dd048f295e55653e4c7789496a)
:   [maven-release-plugin] prepare release 4.2.31

[fc4abea](https://github.com/dcache/dcache/commit/fc4abea60a0cbefe994a1de6d6cfcaa9c8e97d33)
:   pools: JSON mover info timeInSeconds should be timeInMilliseconds

[b74c390](https://github.com/dcache/dcache/commit/b74c3903e90331cb5c2ad090fba558823d7c9d93)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.30

### dcache

Jetty version is updated to  9.4.12.v20180830.

### nfs

nfs4j version is changed to 0.17.11 with  fixed  export table evaluation order.

### resilience

It is now possible to record resilience activity (on the receiving
end), which may prove useful in understanding
behaviour.

In rare circumstances  dark removes  can result in data loss by 
removing of all replicas for a given file. The current release fixed the issue.

Pool operations now can successfully be restarted from the
command line after they have been shutdown, without
restarting resilience.



### Changelog 4.2.29..4.2.30

<!-- git log 4.2.29..4.2.30 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[4e3a9f7](https://github.com/dcache/dcache/commit/4e3a9f77cfda819a105b87c61f63cf9834f8a615)
:   [maven-release-plugin] prepare release 4.2.30

[0ba3158](https://github.com/dcache/dcache/commit/0ba31580d0b8a596072a85b95a185ea436f47769)
:   resilience: update state on pool operations when restarted from admin command

[f17163f](https://github.com/dcache/dcache/commit/f17163f49bc0d166617aa03e39981edee95059a2)
:   libs: use nfs4j-0.17.11

[060e570](https://github.com/dcache/dcache/commit/060e5708e04c210ede4550d228a58f3b9fce01cb)
:   chimera-shell: fix class cast of extractor in constructor

[2b208b9](https://github.com/dcache/dcache/commit/2b208b9c58405c7271531ffa63467c296a3c8318)
:   libs: update jetty version to 9.4.12.v20180830

[87a2fbe](https://github.com/dcache/dcache/commit/87a2fbeda8dc0e7644787eeafb94096132b80445)
:   nfs: fix missing CDC initialization

[584cede](https://github.com/dcache/dcache/commit/584cedefa7557803d83b86793e5f6ef8ad8a95c2)
:   resilience: do simple existence check of replica on pool to avoid dark removes

[cf1a0d9](https://github.com/dcache/dcache/commit/cf1a0d96fd6d9cb9b74b308a8fd756a1287003c2)
:   systemtest: remove ancient replica pools

[ee2ec0e](https://github.com/dcache/dcache/commit/ee2ec0e61b87271030e84929ac452cf1f6e21c4d)
:   [maven-release-plugin] prepare for next development iteration

[98e3198](https://github.com/dcache/dcache/commit/98e3198cf3fab4603bc07af42f6601e566a62f38)
:   resilience: add ability to log resilience activity

## Release 4.2.29

### dcache

rados4j version is updated which contains bugfix  addressing  data corruption on write with HTTP.

### kafka

The current release added ability to specify Kafka receiving topic name: `dcache.kafka.topic=billing`.

### pool

The current release added performance boost for ceph pool.

### resilience

It is now possible to record resilience activity (on the receiving end).

### webdav

The current release fixed resource name for door root error.


### Changelog 4.2.28..4.2.29

<!-- git log 4.2.28..4.2.29 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[8a0c017](https://github.com/dcache/dcache/commit/8a0c017a7b1f51de1af1e85c0c24114fe3c37fa8)
:   [maven-release-plugin] prepare release 4.2.29

[aafa409](https://github.com/dcache/dcache/commit/aafa4097df70a71ccd1e636dc466e542fee46834)
:    pool: grow file prior HTTP TPC

[98bb631](https://github.com/dcache/dcache/commit/98bb631a109499b2eb785ee64c6023464307cc71)
:   pom: use rados4j-0.0.4

[d49df53](https://github.com/dcache/dcache/commit/d49df53d2381e4271e89a937ef24007b03780ed0)
:   resilience: add ability to log resilience activity (incoming)

[e8ac90b](https://github.com/dcache/dcache/commit/e8ac90b856a1249e4c01aec60db4c0da4f7b4e59)
:   kafka: add ability to specify Kafka topic name

[8ba03f6](https://github.com/dcache/dcache/commit/8ba03f68bcc4b5037f820f55d66ab9de82680e64)
:   webdav: fix resource name for door root

[0d7bb40](https://github.com/dcache/dcache/commit/0d7bb4062ff0f07c1a016a3e40b2824095f7a3a6)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.28

### ftp

Now clients can request the checksum value of a file not owned by that
user and where dCache does not already know the checksum value.

### pool

The current release fixed some logging on the pool where messages were recorded against an
arbitrary context (i.e., the bit in square brackets), resulting in
misleading information. 

### transfermanagers

TransferManager failed a transfer if the pool reports any
problem when requesting the transfer was started. This is now fixed and third-party transfer is more robust against non-fatal errors that occur
normally on a busy system.


### Changelog 4.2.27..4.2.28

<!-- git log 4.2.27..4.2.28 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[9ddb29e](https://github.com/dcache/dcache/commit/9ddb29eebea5725d619ac58baa06914ca83adcc1)
:   [maven-release-plugin] prepare release 4.2.28

[367c012](https://github.com/dcache/dcache/commit/367c01250f685bf13579e99d310445e41257a108)
:   transfermanagers: recover from non-fatal error starting mover

[7353b40](https://github.com/dcache/dcache/commit/7353b405b7a3e21905e04e85fe242530bd3d67e9)
:   pool: fix CDC for repository listener notification

[e81337b](https://github.com/dcache/dcache/commit/e81337b24011746e7c91c61f83f48a2770574de3)
:   ftp: store calculated checksum using root privileges

[3e97b6c](https://github.com/dcache/dcache/commit/3e97b6ce5f50a806d0e4597ac6dc518738bb4d65)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.27

### gplazma

Due to a formatting issue, certificates issued by InCommon CA were not accepted
because of case mismatches between the supplied "postalCode" and "street" 
and the expected "PostalCode" and "STREET" field descriptors.

Since this release, dCache handles those certificates as expected despite the
unusual naming convention.

### pool

There was an issue with the timestamps output by the `sweeper ls`
command. The command lists replica creation time and the time of 
the last access. The output for replica creation time was incorrect,
as it showed the startup timestamp for the replica's pool if that
was more recent than the actual creation time of the replica.

This issue was fixed, and the timestamps are showing the correct values now.

### webdav

When users request a macaroon via an HTTP POST request targeting
a specific path, a caveat is created that restricts the macaroon
to that path (requests to / result in a non-limited macaroon). 

Commit 99c726e3 resulted in users getting back a non-limited
macaroon for every request. This issue was fixed with this
release.


### Changelog 4.2.26..4.2.27

<!-- git log 4.2.26..4.2.27 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[0f9417c155](https://github.com/dcache/dcache/commit/0f9417c15560a1daf62cb64a4934798c85e79d75)
:   [maven-release-plugin] prepare release 4.2.27

[e5de51d28d](https://github.com/dcache/dcache/commit/e5de51d28d61b2fa456b03aae00c74468ae71231)
:   systemtest: fix OpenSSL DN format change

[d3be93e958](https://github.com/dcache/dcache/commit/d3be93e95802d372e1201d6681cb7f6f5fc37804)
:   webdav: fix path-to-caveat for macaroon minting endpoint

[eefd8ee5f3](https://github.com/dcache/dcache/commit/eefd8ee5f3611a487e09917ef888079a50b0fed4)
:   gplazma gridmap plugin: compare DNs ignoring letter case for attribute names

[c9cf8f7670](https://github.com/dcache/dcache/commit/c9cf8f7670de263a04bbc458a8cc924685cad14a)
:   webdav: fix NPE when Kafka notified file deletion

[9069ab99a3](https://github.com/dcache/dcache/commit/9069ab99a3f08daf83c0426154a10eadc95059b4)
:   [maven-release-plugin] prepare for next development iteration

[121a95ccd8](https://github.com/dcache/dcache/commit/121a95ccd8a9d4a81eff3f029dd9d8259b57129c)
:   pool: report correct replica creation time to sweeper

## Release 4.2.26

### admin

he current support added  direct command execution capability and  it works with support for semicolon (;) separated list of commands like so:
`ssh -p <port> user@example.com "command1; command2; command3"`.

### alarms

Pool errors involving a fatal repository fault, for
instance, can be sent now  as an email alarm without
having to send all pool disabled alarms.

### billing

Better formating for storageInfo key, when events send with kafka producer.

### dcache-view

Troubles when using firefox and/or safari to browse dcache-view were reported. This is now fixed.

### gplazma

The JAAS gplazma plugin no longer logs a stacktrace on bad configuration.

### pool

The current release improved error messages  making them clearer by avoid using the same error message in multiple places. 

The current release boosts performance  for ceph pool.

The current release fixed lookup for canonical hostname for IPv6 addresses  and now secure HTTP transfers work over IPv6 and problems are easier to diagnose.


The current release improved error message  (previously "Could not create mover") to provide
more information about why the mover could not be created.

### srm

A stack-traces fixed  for  concurrent updates in pin-manager and similar
(expected) failures.

### transfermanager

When  transfermanager returns an error to the caller (e.g., WebDAV) if
there was a problem starting the mover. This message did not include
any details describing on which pool this failure occured.  This is now fixed and HTTP TPC failures in which the pool does not start the mover now include
the pool's address in the error message. This allows admins to
investigate further.

Now Third-party transfers fail if the client is requesting to copy a file
from dCache that has not fully been uploaded.

### webdav

Disabling basic authn should not now disable macaroons. The current release fixed  `webdav.authn.basic` and `frontend.authn.basic` so that setting
these configuration properties to `false` no longer blocks macaroons from being accepted in the HTTP Authorization header.

The current release impoved error messaging  for unauthenticated request. 

IllegalArgumentException exception is fixed now and attempts by a client to copy a file that has not fully been uploaded 
results in a clear error response.

The current release added switch to reject macacroons sent unencrypted and now  following security recommendations sites may configure dCache to reject any macaroons send over an
unencrypted channel. The default behaviour is to continue accepting macaroons sent over an
unencrypted channel to avoid breaking existing deployment.


### Changelog 4.2.25..4.2.26

<!-- git log 4.2.25..4.2.26 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[5bdc686](https://github.com/dcache/dcache/commit/5bdc6860d4d607a09d03b6a4c2d191fbc31ecd2b)
:   [maven-release-plugin] prepare release 4.2.26

[5121043](https://github.com/dcache/dcache/commit/512104383cebe7451c690818c8be6e02e42e4d46)
:   webdav/frontend: add switch to reject macaroons sent unencrypted

[4ad054e](https://github.com/dcache/dcache/commit/4ad054ee9839c90b1182a6ad114437f1632c2349)
:   webdav/frontend: disabling basic authn should not disable macaroons

[82264f9](https://github.com/dcache/dcache/commit/82264f93f4909969c9cd6ee82481e71eb7c87aad)
:   srm: do not log a stack-trace on expected Exception errors

[790ee1f](https://github.com/dcache/dcache/commit/790ee1f8e30fb9f3d12f43c2e0ee4c75b33acc92)
:   transfermanager: fail third-party copy if the file is still being uploaded

[7da9884](https://github.com/dcache/dcache/commit/7da9884a71d981d5faa874b4a2a7bc466076b8f1)
:   webdav: fail COPY early if file is currently being uploaded

[60f0ba2](https://github.com/dcache/dcache/commit/60f0ba282377156a85d5e066bfaf0202013a0e37)
:   transfermanager: abort transfer if there is a bug

[0f26643](https://github.com/dcache/dcache/commit/0f266433aa4117775bfffc96cdb5e9a5aeaca9cc)
:   gplazma: JAAS plugin logs a stack-trace on misconfiguration

[8713437](https://github.com/dcache/dcache/commit/8713437200e0e5d369920dc0e57555801a25b2cf)
:   transfermanager: include pool address in the mover start failure message

[98bfa14](https://github.com/dcache/dcache/commit/98bfa1457ee41c8d3b746056ae4bfa8e26e0a82f)
:   pool: update error messages to make them distinct

[9ed620c](https://github.com/dcache/dcache/commit/9ed620c7f6385203c4e3f5c0742b1b9e445c3cd6)
:   pool: avoid using the same error message in multiple places

[d80db22](https://github.com/dcache/dcache/commit/d80db22b196dc813cc4494eb02498c0bce9e12a6)
:   alarms: add pool dead alarm

[24740b9](https://github.com/dcache/dcache/commit/24740b9c35782da7b70e9fa5c33fd878ec14e60b)
:   pool: fix lookup for canonical hostname for IPv6 addresses

[9e20b62](https://github.com/dcache/dcache/commit/9e20b6223ef0383e647a61d3269d63dd70ef421a)
:   admin : add direct command execution capability

[f3e9526](https://github.com/dcache/dcache/commit/f3e9526801eb67a66e46156f1e5b04d1bc8a3c0f)
:   pool: grow file prior FTP upload

[11a9671](https://github.com/dcache/dcache/commit/11a96715f22a8d913ecb6c380093f3a46cbc9e1e)
:   [maven-release-plugin] prepare for next development iteration

[5c8685e](https://github.com/dcache/dcache/commit/5c8685e6c9111fc03fae801aaf12e1b50e97b4f5)
:   pool: don't update atime on flush

[81fc28d](https://github.com/dcache/dcache/commit/81fc28d714331df9620bdea81b0eb2fc5140f97d)
:   scripts: fix 'dcache pool yaml' command

[1e277b4](https://github.com/dcache/dcache/commit/1e277b47116aa005d4b3bea7e67a2a2931e5d063)
:   webdav: 401 for unauthenticated requests; message in status line

[a6d7daf](https://github.com/dcache/dcache/commit/a6d7daf285f441a9e27b2310e65ea2e3756bc95e)
:   dcache, frontend: release dcache-view version 1.5.3

[c37e589](https://github.com/dcache/dcache/commit/c37e5899d277019b005d7fb85864d2839a0326fb)
:   door: fix issue 4551 (wring storage)

[7cfa48a](https://github.com/dcache/dcache/commit/7cfa48a77995d3e6f19c9d5ad4d40e3122ed0a7b)
:   dcache: update kafka-client lib version to 2.1.0

## Release 4.2.25

### dcache-frontend

The current release added documentation concerning restores.

### ftp

The current release fixed MLSC command for non-small directories and Globus is now able to list directories with > 100 directories.

### xrootd4j

The current release updated  the xrootd4j including the following fixes and improvements:
add ERROR status to tpc info, change the protocol version to int, prevent NPE when constructing error response, 
fix path handling in move request, correctly handle multiple authn protocols as indicated by server,
 handle correctly IO/Security exceptions on credential loading and  distinguish correctly between kXR_wait and kXR_waitresp.



### Changelog 4.2.24..4.2.25

<!-- git log 4.2.24..4.2.25 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[6723aa4](https://github.com/dcache/dcache/commit/6723aa477bb98f1cfb97ec369c1fa0d7ad66f01b)
:   [maven-release-plugin] prepare release 4.2.25

[e4d03d7](https://github.com/dcache/dcache/commit/e4d03d71541e55657f0b4f5327ac727f7b06645a)
:   ftp: fix MLSC command for non-small directories

[ffe9566](https://github.com/dcache/dcache/commit/ffe9566cb17403fd6dcb258a5d5e2e4156054189)
:   dcache-xrootd: remove mv request hack

[7625685](https://github.com/dcache/dcache/commit/76256858075d19939208b62639f56a958dff18a9)
:   dcache-frontend: add documentation concerning restores

[ba5d0d2](https://github.com/dcache/dcache/commit/ba5d0d2412327ba38f49ea43e5806ec1caa0f196)
:   pom.xml: update xrootd4j dependency to 3.3.4

[eedc6e1](https://github.com/dcache/dcache/commit/eedc6e1221146b7ecb4250535adfb92dcb34e13c)
:   dcache-frontend: undefined suid parameter on transfers should be NULL not "null"

[d6fd146](https://github.com/dcache/dcache/commit/d6fd14646a8b7fe95f450dd2839a13289b8cbcc6)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.24

### billing

Database connection loss now is reported for billing.

### libs

postgres-jdbc  is updated to 42.2.5  resulting in  better integration with postgres 10 and better support for java11.

### nfs

The NFS door assumed that routable IP address, like 130.199.49.35, in general can't
access private subnet, like 10.1.1.1. This assumption was not always true for all sites
and ended up with non functional pNFS deployment.
This is now fixed.

### webdav

The current release fixed the problem where all but one requests fail, if multiple concurrent PUT requests have directories in the path that do not already exist. 

### zookeeper

The current release updated the lib version for zookeeper to 3.4.13 with  minor version update with many bugfixes.
See: https://zookeeper.apache.org/doc/r3.4.13/releasenotes.html.


### Changelog 4.2.23..4.2.24

<!-- git log 4.2.23..4.2.24 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[add726d](https://github.com/dcache/dcache/commit/add726de882b049a124c784056ded1554607b399)
:   [maven-release-plugin] prepare release 4.2.24

[9f379b8](https://github.com/dcache/dcache/commit/9f379b8f0e78028c6b7f38564b24beeefbdd7850)
:   nfs: do not filter device's IP addresses based on site locality

[02b0ed4](https://github.com/dcache/dcache/commit/02b0ed4d45775f2a49e1f61a514f5bf209e151ab)
:   dcache: wrap billing data source with AlarmEnabledDataSource

[b9dbf8b](https://github.com/dcache/dcache/commit/b9dbf8b320991ba32142b618dfd39cc76183583d)
:   libs: use zookeeper-3.4.13

[41231b3](https://github.com/dcache/dcache/commit/41231b3d8cd846efb5de3f6e1a9a110837e5ab8f)
:   libs: use postgres-jdbc 42.2.5

[25bb88d](https://github.com/dcache/dcache/commit/25bb88d92a48abdc5730aef1e8bb4fd40275cfdd)
:   common: fix random data generation in TimeseriesHistogram unit test

[e8e5aa4](https://github.com/dcache/dcache/commit/e8e5aa4bd881494e2bae29529aaa62be5991b3d6)
:   webdav: work-around Milton racy API for creating collections

[f04def1](https://github.com/dcache/dcache/commit/f04def1ca7ed6a433fc24c876ef3d93b76131c20)
:   webdav: fix name of root

[517279f](https://github.com/dcache/dcache/commit/517279f502e5963971af597f45a84e72010b10e8)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.23

### dcache-view

The following new functionalities have been added for dCache View:
Now it is possible to use macaroon for file sharing.
Files can be shared by sending the generated link, QR code or macaroon for the files to the person you want to give access to your files.
Gravatar request is now make optional and how the images are stored are now more efficient to reduce the number of request made.

### gplazma

Since update to newer CANL and voms-java-api libraries
sites report VOMS certificate validation errors like so:

```
[[canlError]:CAnL certificate validation error: Signature of a CRL corresponding to this certificates CA is invalid, [invalidAcCert]:LSC validation failed: AA certificate chain embedded in the VOMS AC failed certificate validation!, [aaCertNotFound]:AC signature verification failure: no valid VOMS server credential found.]
```

This is a consequence of not refreshing certificates from trust anchor
directory in gPlazma voms plugin. The refresh is enabled by passing a regresh interval
option when setting up voms validator. The patch
[fab850d](https://github.com/dcache/dcache/commit/fab850d66e295596737aca9a4482165c0bf459ba)
adds two variables `gplazma.vomsdir.refresh-interval` and `gplazma.vomsdir.refresh-interval.unit`
that control refresh interval:

```
gplazma.vomsdir.refresh-interval = 4
(one-of?MILLISECONDS|SECONDS|MINUTES|HOURS|DAYS)\
gplazma.vomsdir.refresh-interval.unit = HOURS

```
Without this fix voms plugin fails to validate voms certificates rendering dCache non-operational.
Therefore sites runing dCache releases 4.2.15-4.2.22 are strongly encouraged to upgrade.


### nfs

The current release fixed the bug introduced by `ByteBuffer#limit`, which is used instead of
`Buffer#limit`.

### srm

The `dcache ports` command now includes the srm's TLS/SSL interface.


### Changelog 4.2.22..4.2.23

<!-- git log 4.2.22..4.2.23 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[1eb4f14](https://github.com/dcache/dcache/commit/1eb4f140f18f04f3ead16c50be5b442bb15e2f81)
:   [maven-release-plugin] prepare release 4.2.23

[fc0cb33](https://github.com/dcache/dcache/commit/fc0cb33dcf6a7607ad1795d49c7b2d2e58a59505)
:   pom: use nfs4j-0.17.10

[fab850d](https://github.com/dcache/dcache/commit/fab850d66e295596737aca9a4482165c0bf459ba)
:   gplazma voms plugin: add trust anchor refresh paramater

[e446b45](https://github.com/dcache/dcache/commit/e446b45e32dcde93c16825dc91397f8e896efe36)
:   srm: include TLS/SSL port in 'dcache ports' command

[e5f6959](https://github.com/dcache/dcache/commit/e5f69597bab5a7e18f99bee606947097f4bd70d2)
:   dcache, frontend: release dcache-view version 1.5.1

[228bfb7](https://github.com/dcache/dcache/commit/228bfb7078fd3ad4b5838ea4ca63188734a9ee6c)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.22

### Changes affecting multiple services

The current release corrected the properties for access-log.

### nfs

New nfs4j version 0.17.9 with improve performance for file system locks is release now.


### Changelog 4.2.21..4.2.22

<!-- git log 4.2.21..4.2.22 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[55085b5](https://github.com/dcache/dcache/commit/55085b5b10cedcf66a1991697a4e4ca75b51c97f)
:   [maven-release-plugin] prepare release 4.2.22

[ace5d36](https://github.com/dcache/dcache/commit/ace5d36766e77c70ee988555d0ceaa98a8a8de66)
:   libs: use nfs4j-0.17.9

[933a628](https://github.com/dcache/dcache/commit/933a62825d906456686fc8404020938dd26be737)
:   correct the properties for access-log

[3666c72](https://github.com/dcache/dcache/commit/3666c72f34ca79923e135bb0f936c4eeb48e4b4a)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.21

### Changes affecting multiple services

If a client specifies a checksum value with either a WebDAV or FTP upload,
a `Restriction check by-passed due to missing path` warning was logged occasionally.
This was fixed now, ensuring that restrictions are always applied.

### gplazma

In situations where a user's numerical UID is already known, but other attributes
are still needed, gPlazma can now query an LDAP server using the uidNumer attribute.
The property `gplazma.ldap.try-uid-mapping=true|false` (defaulting to false) in the
`gplazma.properties` file to control this new feature.


### nfs

The NFS property `nfs.idmap.manage-gids` was added to help overcome
a traditional 16-group limit for users: If a client uses AUTH_SYS and a user
has more than 15 subgroups, the NFS door will query gPlazma to discover additional
user groups.

### pool

Space reservations on pools that are connected to tape showed a problem with
failing restore requests: If a restore failed, the space that was reserved to
hold the file that was supposed to come in from tape was not freed again but
kept in the 'sticky' state. This resulted in lots of unusable space on pools
that could only be reclaimed through a restart.

With the current release, this issue is fixed and space is freed as soon
as possible after a failed restore request.

### resilience

A very rare race-condition is fixed where a failed upload results in
resilience recording a stack-trace.

### webdav

An issue with the Milton WebDAV library prevented Partial (or vector-read) GET requests
from succeeding. This was fixed now through both an update of the dependency and a local
patch while we wait for the proposed fix to be included upstream.


### Changelog 4.2.20..4.2.21

<!-- git log 4.2.20..4.2.21 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[4b0eab45b0](https://github.com/dcache/dcache/commit/4b0eab45b0740c5ff0718bf01ed533dcecb34342)
:   [maven-release-plugin] prepare release 4.2.21

[cd3d1bc8ba](https://github.com/dcache/dcache/commit/cd3d1bc8ba39ce2aa940993560ae54745e703fc3)
:   webdav: fix proxied partial (vector-read) GET requests

[30c15824b0](https://github.com/dcache/dcache/commit/30c15824b0c667d55a79fc594ea338842dd9a33b)
:   nfs: overcome the 16 group limit of AUTH_SYS

[e32bca8d3c](https://github.com/dcache/dcache/commit/e32bca8d3cc8118092f16c953514c093e5463706)
:   pool: fix pool space accounting on failed restores

[e8d6ee19b3](https://github.com/dcache/dcache/commit/e8d6ee19b302146c593950c11c0575a724c5aae3)
:   resilience: fix NPE if file unlinked when resilience processes a broken file

[5d3864a423](https://github.com/dcache/dcache/commit/5d3864a423bc578a006f26b2f2be3e0406a4e60d)
:   ldap: search user by uidNumber attribute if only UidPrincipal is provided

[870fffd119](https://github.com/dcache/dcache/commit/870fffd119e5380e286484151dae639c77c706d4)
:   ftp/webdav: fix bypass of restrictions

[b27b6a26fb](https://github.com/dcache/dcache/commit/b27b6a26fb06d8e49aed5b750b09a235e68018eb)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.20

### alarms

An internal issue with the alarms configuration was fixed, which
should prevent a rare NullPointerException from occuring.

### dcap

Creating a file or directory using the DCAP protocol with a URL
as parameter, the file permissions were not set correctly.

With the current release, this was corrected, and such files
use the client-supplied file permissions. If none are provided,
the default modes 0700 (for directories) and 0600 (for files)
are used.

### nfs

When a pool is decomissioned, clients can now be notified about
the need to terminate any remaining connections. The
`pool reset id` command was updated to issue a device change
notification callback.

### xrootd

Interoperability with the 4.9.x client series was improved.

An uncaught exception in xrootd doors was fixed.


### Changelog 4.2.19..4.2.20

<!-- git log 4.2.19..4.2.20 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[85b441434f](https://github.com/dcache/dcache/commit/85b441434fce8b86f5c365ecb76f703991d53e9c)
:   [maven-release-plugin] prepare release 4.2.20

[3ac7332249](https://github.com/dcache/dcache/commit/3ac73322495db1c4b97b60e90c1dee7cebe102f4)
:   dcache-xrootd: add missing query support for tpc on pools

[d4ed957a18](https://github.com/dcache/dcache/commit/d4ed957a1891f617e8cc18cc300c6da5e253ecb4)
:   alarms: fix persistence.xml configuration

[f4154f7f0c](https://github.com/dcache/dcache/commit/f4154f7f0ce09d9abb8fe949a35873a6b5a4cd02)
:   dcap: fix permission propagation with DCAP

[f8fa92a4ae](https://github.com/dcache/dcache/commit/f8fa92a4ae30a0da86db8b12259e6651ba0f7854)
:   dcache-xrootd: handle possible race condition in directory listing

[7f5a40d021](https://github.com/dcache/dcache/commit/7f5a40d0210fc233ea2addba63c447ef992f47f0)
:   nfs41: update `reset pool` command to issue cb device notify

[3d6fc445f0](https://github.com/dcache/dcache/commit/3d6fc445f057bfd19d2f8c48fc443f5d059bafaf)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.19

### Changes affecting multiple services

Jacco verison is updated so that the code coverage is now possible
with java11 runtime.

### libs

The current release modified the nfs4j version, which contains bugfix
and enhancements, such as fix layoutget usage with current stateid and
respectively.

### nfs

When door performs an async pool selection this process should be
blocked.  However, we should block when request is performed the very
first time to handle busy system and slow networks. This is now fixed
and a client is not blocked if door knows that the request is not
processed yet.

### statistics

Metadata merge was using max when it should had used min, this is now
fixed.


### Changelog 4.2.18..4.2.19

<!-- git log 4.2.18..4.2.19 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[b816e01](https://github.com/dcache/dcache/commit/b816e016745d484cea70113395e6ad7a4b3eab33)
:   [maven-release-plugin] prepare release 4.2.19

[d8e9ac4](https://github.com/dcache/dcache/commit/d8e9ac45475492eb1338c76c24006b41d1631983)
:   libs: use nfs4j-0.17.8

[baa4c0d](https://github.com/dcache/dcache/commit/baa4c0d02d911c7b7735ecd9687ddf68dc4d1f2b)
:   pom: use jacoco with java11 support

[0ab1148](https://github.com/dcache/dcache/commit/0ab1148eab4a2dfd96727e090d6c4679b7376fb0)
:   common: fix histogram metadata merge

[b0f6ae5](https://github.com/dcache/dcache/commit/b0f6ae5015b12f75ec3b0c6d81abe7a0d4c1b1b3)
:   dcache-frontend,dcache-history: revisit NPE fix

[85f8957](https://github.com/dcache/dcache/commit/85f8957de1fe2d02b083b8f936d4bdb3a649f242)
:   nfs4: only block pool selection on the first attempt

[61afa20](https://github.com/dcache/dcache/commit/61afa2071798caf02579daedac000b94ab8dba70)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.18

### dcache-view

The current release added several bug fixes and improvement to dCache view.

### gplazma

The voms plugin now includes the user's DN in the logged error message
if it cannot validate the VO-membership information.

### nfs

It is possible now to reset pool selection task if pool disabled
before redirect after receiving start mover.

A stack trace on remove of a missing file is fixed.

### pool

The current release fixed failing HTTPS redirected transfers.

Download and upload via HTTPS in dCacheView required the pool to support
CORS. This is now fixed and dCacheView upload and download now succeeds.


### Changelog 4.2.17..4.2.18

<!-- git log 4.2.17..4.2.18 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[3a463d7](https://github.com/dcache/dcache/commit/3a463d723f00f4f7999de66ff549e3001e3d7f31)
:   [maven-release-plugin] prepare release 4.2.18

[fd3a263](https://github.com/dcache/dcache/commit/fd3a26386a734acc033f8d23aeb5233d04fbdce6)
:   restful: Return not Found/404 for non existing pool.

[0323a84](https://github.com/dcache/dcache/commit/0323a84cf27a277ffd106dbbf90660d9a2292bca)
:   nfs: reset pool selection task if pool disabled before redirect

[4015559](https://github.com/dcache/dcache/commit/40155597cea961d3b0ff988728667bbe99530038)
:   dcache: release dcache-view version 1.5.1

[f573141](https://github.com/dcache/dcache/commit/f573141f707190b76c2f898cda1b51ed67cde55c)
:   gplazma2: Log credential information on x509 cert. chain validation and FQAN extraction failures.

[cf01d6a](https://github.com/dcache/dcache/commit/cf01d6a225bcca1196bae60d607f5d11c24c7b6c)
:   nfs: ignore JdbcFs errors when constructing acceess log entries

[ce71873](https://github.com/dcache/dcache/commit/ce718735ed9ae9acb7de18187a17e4a6727f4e35)
:   libs: update nfs4j to version 0.17.7

[0d11f86](https://github.com/dcache/dcache/commit/0d11f86677f8db16db7d3c6236b6582ca52b1f92)
:   nfs: handle chimera exception on remove of a missing file

[9859ca0](https://github.com/dcache/dcache/commit/9859ca08831b6c8390daa5934a092c461e1e1fab)
:   pool: add CORS support for HTTP requests

[1fe6c73](https://github.com/dcache/dcache/commit/1fe6c738e149b0958c6c9b1160fb4aa55da8d5c8)
:   pool: use hostname in HTTPS redirection URL

[37da2fd](https://github.com/dcache/dcache/commit/37da2fd01c12d883d582abecc00693f9eac84716)
:   [maven-release-plugin] prepare for next development iteration

[6d5d9f1](https://github.com/dcache/dcache/commit/6d5d9f1222d272d3ac712a3892e9dcbd320137bb)
:   dcache: release dcache-view version 1.5.0

## Release 4.2.17

### ftp

Leaking server sockets were observed when a client aborted a proxied transfers
with kafka enabled. This is now fixed and No further server sockets leaked when a proxy is being used, kafka
notification is enabled, and the client aborts the transfer.

### chimera

Chimera shell is now able to find origin tags of a given name.

### pool

The current release fixed stopwatch error and now IO-statistics collecting is more robust,
 avoiding stack-traces with the message `This stopwatch is already stopped`.

### restful

No function name/operationIds clashes for the swagger generated clients.

### srm

Clients that use the gridsite protocol, such as davix, can now delegate
their credential.


### Changelog 4.2.16..4.2.17

<!-- git log 4.2.16..4.2.17 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[23c0d9f](https://github.com/dcache/dcache/commit/23c0d9f0262337f3635cb99d0f6f5824e65e8523)
:   [maven-release-plugin] prepare release 4.2.17

[daf27f6](https://github.com/dcache/dcache/commit/daf27f6c27fadae53d0f07f769a25bbd8f144e68)
:   dcap: fix  NullPointerException:

[1178f8f](https://github.com/dcache/dcache/commit/1178f8f66521c3f6d2fc670209350576fca068a5)
:   restful: Rename operations to have unique operationId.

[7494641](https://github.com/dcache/dcache/commit/74946415bbcae6bc9f9cbf1bacfa12dc71143246)
:   ftp: avoid kafka bug, make shutdown more robust

[3ad364e](https://github.com/dcache/dcache/commit/3ad364e7b862902e25813a633c614214a79b3b42)
:   dcache-history,dcache-frontend: check for serialized error when handling pool data request messages

[272c627](https://github.com/dcache/dcache/commit/272c6279087f944826bbed2b16c8e40341c5d1ec)
:   pool: fix stopwatch error

[6ac21a4](https://github.com/dcache/dcache/commit/6ac21a40ffd54bca9241591801019bc1ca194bad)
:   common: fix bug in CountingHistogram index computation

[2ef9022](https://github.com/dcache/dcache/commit/2ef90226159188fb2ad7012947e9f05a1339436e)
:   libs: update to nfs4j-0.17.6

[eb161be](https://github.com/dcache/dcache/commit/eb161be061dab450cc0d7f2783ca9c205d616e46)
:   [maven-release-plugin] prepare for next development iteration

[45c992d](https://github.com/dcache/dcache/commit/45c992d543a7707d83cf3db8df245d9eeed52296)
:   srm: gridsite fix querying validity of delegated credential

[549ce6f](https://github.com/dcache/dcache/commit/549ce6fac80c02f497644e442cf81bc6f84cf125)
:   chimera: support origin tag discovery

## Release 4.2.16

### frontend

A new property, `frontend.authz.unlimited-operation-visibility`, in the frontend now controls visibility
of operations exposing file metadata. The default
is false, meaning non-admin users can only see
file operations for files which they own or which
are anonymous. Setting it to true allows everyone
access.

### ftp

The behaviour of FTP transfers was made more robust in cases where a client
disconnects from the control channel prematurely.

The performance markers that dCache sends back to the client in FTP transfers
are now more robust against bugs.

### nfs

When transient errors in pools cause NFS transfers to have to wait and retry,
the system's behaviour is now more robust and no StackOverflowErrors should be logged any more.

### scripts

Maven's findbugs plugin is now granted more working memory in order
to make builds, especially on our continuous integration system,
more robust.

### srm

Certificate lifetime considerations for VOMS proxy certificates are
improved in this release: if a
client delegates a credential where the VOMS AC expires before the X.509
proxies, dCache now will not use the credential beyond the AC expiry time.
This avoids unnecessary authentication errors.

### webdav

When the WebDAV door is considering an HTTP third-party-copy request
that uses grid-site delegation, there is a minimum 20 minute validity
that any existing delegated credential must satisfy. If this is not
satisfied then dCache will request a fresh delegated credential.

Until now, if the client failed to delegate a fresh certificate then the
subsequent COPY request was rejected. This release changes that behaviour
and enables such transfers.


### Changelog 4.2.15..4.2.16

<!-- git log 4.2.15..4.2.16 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[c968d5e646](https://github.com/dcache/dcache/commit/c968d5e64615bb1a8046457f93fe8e14ca757809)
:   [maven-release-plugin] prepare release 4.2.16

[597047c4a5](https://github.com/dcache/dcache/commit/597047c4a54c36df02198f9e92c0803116514f88)
:   nfs: increase request retry delay when selecting/starting  pool or mover

[e1f93b74bc](https://github.com/dcache/dcache/commit/e1f93b74bc369dbedc811758c0b88dfa753c4bd6)
:   dcache-frontend: provide switch to control visibility of file operations for non-admin users

[fabb8044d8](https://github.com/dcache/dcache/commit/fabb8044d8898f183d66f09435dca9440d422b86)
:   webdav: adjust minimum validity after requesting delegation

[935e4825bb](https://github.com/dcache/dcache/commit/935e4825bbf6a8dfcc83ba3e6865491549daf0fe)
:   srmmanager/webdav: consider VOMS AC validity of delegated credential

[b1e41c1bc3](https://github.com/dcache/dcache/commit/b1e41c1bc3bef4e284dc7ea94f04aa6a9dbf8ad6)
:   ftp: make performance marker task robust.

[903847efb5](https://github.com/dcache/dcache/commit/903847efb5bdec73e3ee8786c8e684db0c200162)
:   ftp: avoid NullPointerException if adapter is not connected

[296fecec02](https://github.com/dcache/dcache/commit/296fecec02f883526abe4e7810db94b1d7ebd76c)
:   [maven-release-plugin] prepare for next development iteration

[8d1dcf5cc8](https://github.com/dcache/dcache/commit/8d1dcf5cc8bc52097404f1bc7314cddff1ee02b7)
:   scripts: Avoid findbugs memory errors

## Release 4.2.15

### libs

This release includes updated library versions Bouncy Castle 1.54, CANL 2.5.0 and
voms-api-java 3.3.0 which, in addition to the usual security updates, should
help resolve the "pad block corrupted" issue that a few deployments showed
with xrootd transfers.

### pool

Diagnostic logging for failed HTTP third-party transfers was improved.

Billing records for failed transfers now show more detailed information.

The handling of cancelled flush requests for nearline media
was rewritten to be more efficient. This resolves issues where pools
report "Flush of 0000... failed with: CacheException" followed by
"Pool restart required: Internal repository error".

Compatibility with DPM was improved by increasing HTTP GET requests' timeouts.
This should allow more transfers to succeed.

### poolmanager

Supplying poolmanager with an unresolvable hostname as the target will
now result in an UnknownHostException instead of the previous behaviour
where an (unnecessary) NullPointerException was thrown.

### scripts

The format and content of the Storage Description JSON file have been updated
according to WLCG suggestions:

- 'capacity_id' field is renamed to 'name'
- 'total_space' and 'used_space' renamed to 'totalsize' and 'usedsize'
respectively.
- 'timestamp' field added
- 'vos' field added
- 'assignedendpoints' added.  Currently hardcoded to "all".

### srm

Logging of errors in the SRM credential store was improved.

### webdav

If a non-resolvable host name is given as the source or destination
of a third-party copy request, WebDAV will now fail the transfer
immediately instead of waiting for a Poolmanager timeout.

Diagnostic logging for failed HTTP third-party transfers was improved.

### xrootd

dCache allows xrootd clients to specify a query/opaque string in a
kXR_mv request's source path.


### Changelog 4.2.14..4.2.15

<!-- git log 4.2.14..4.2.15 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[0d84527d7c](https://github.com/dcache/dcache/commit/0d84527d7c14228e5744b9d4e029af2022db6320)
:   [maven-release-plugin] prepare release 4.2.15

[09543a34bb](https://github.com/dcache/dcache/commit/09543a34bbd907d6bc788118b821a1bb151fda0b)
:   pool: HTTP TPC rework exception logging

[4220befbbc](https://github.com/dcache/dcache/commit/4220befbbc7790328125d687032b42b5675c838a)
:   pool: increase TPC socket timeout for GET requests

[0ef9014b0b](https://github.com/dcache/dcache/commit/0ef9014b0b917ae0ab987da8c4d721a27af9bc7f)
:   srm: fix credential store logging

[ae6cc5f15d](https://github.com/dcache/dcache/commit/ae6cc5f15d3d33daa235fc8b0466a956ce370fbf)
:   pool: update log status using exception class name if no message

[c4262b3b1c](https://github.com/dcache/dcache/commit/c4262b3b1cd07413ed8e883831123b7e21ed5e90)
:   storagedescriptor: update information based on WLCG feedback

[089d7335ef](https://github.com/dcache/dcache/commit/089d7335effc78c412b1066bf16a9f0e3faf26f8)
:   xrootd: strip off query part from kXR_mv source

[4a5473b86e](https://github.com/dcache/dcache/commit/4a5473b86e1c7e6b85d0f37c5b6dabfb89e0abc0)
:   webdav: fail TPC request early on unknown hostname

[9ecfc52ce9](https://github.com/dcache/dcache/commit/9ecfc52ce907fa34ef2799d15ef591ba938586f2)
:   nearline-provider: do not propagate thread interrupt flag

[cbc1223b39](https://github.com/dcache/dcache/commit/cbc1223b39d1fbd0ee85757ecedbe81c4dbd1e38)
:   poolmanager: fix NPE on unknown host

[61a3174bd7](https://github.com/dcache/dcache/commit/61a3174bd71464ba1eb67675959c3b7f85f8313c)
:   webdav: improve logging of TPC requests

[eafbd5c1b1](https://github.com/dcache/dcache/commit/eafbd5c1b11d3525787c80136d8dc81b52f44427)
:   libs: upgrade to bouncycastle 1.54,  CANL to 2.5.0 and voms-api-java to 3.3.0

[3a021a49e8](https://github.com/dcache/dcache/commit/3a021a49e8526d745c069bae533848085456c6dd)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.14

### Changes affecting multiple services

In order to more easily identify a rejected macaroon in the logs, its ID is now included in the log message.

After discussing an issue observed in a production system at DESY,
we decided to revert this commit until a more thorough analysis
was done. The original intent of this change was to resolve rare
"pad block corrupted" issues with xrootd transfers.

xrootd now shows IP addresses instead of (potentially ambiguous) hostnames as transfer endpoints.

An irrelevant stacktrace was logged on unexpected CacheExceptions. This
was removed, leading to less clutter in the logs.

Different macaroons that were issued against the same secret are now discernible in the logs.

Users now get more information about the reasons why an invalid macaroon was
rejected: HTTP requests that are made with an invalid macaroon have a 401 HTTP
response with the status-line explanation phrase that describes why the
macaroon is invalid.

The access log file also logs why a macaroon was rejected.

### core

A library dependency was updated to avoid [CVE-2018-11771](https://nvd.nist.gov/vuln/detail/CVE-2018-11771). This patch introduces no user-visible changes.

### frontend

[Github issue #4242](https://github.com/dCache/dcache/issues/4242) was resolved;
cell information can now be be gathered using the REST interface without
specifying domains.

### gplazma

Invalid macaroon logins no longer "spam" gPlazma.

Group Identifier numbers (GIDs) can now freely be chosen from within the numerical range
defined by Java's long data type, up to 2<sup>64</sup>-1.

### httpd

Transfer information was improved: A call to hostname.tld:2288/context/transfers.json now also includes path info for transfers.


### pnfsmanager

When creating a macaroon to allow uploading of data, the desired path
may not already exist. Without restrictions, WebDAV will auto-create
parent directory items that are missing, or the client can create these
directory elements explicitly with MKCOL.

With restrictions (such as from a macaroon) such directory creation
currently requires the MANAGE activity, which allows other actions
beyond the scope of this scenario. With this release, the behaviour
was changed so that a user with a macaroon that authorises them to upload data into a
particular directory will be able to create parent directories to
achieve uploading the data.

### pool

A regression caused pools that had their size only specified in a layout file
to report a size of 8 Exabytes. This issue was fixed.

dCache now supports a DPM-specific HTTP extension that indicates the
checksum calculation is not yet complete, avoiding potential data
corruption with third-party copies: If DPM is calculating a checksum, then any RFC 3230 (i.e., with a
'Want-Digest' header) GET or HEAD request returns '202 Accepted' respond
status line and an HTML page as the response entity. Since dCache
considers any 2xx response as success, the HTML page was previously accepted as the
file's contents, resulting in data corruption.

dCache pools no longer log a stack-trace for non-bug P2P failures.

### srm

The domain '.access' log file now contains log information for grid-site
delegation activity, which facilitates debugging of http third-party-copying issues.

### transfermanagers

The "restriction check by-passed" warning for each WebDAV-initiated
third-party transfer is fixed.

### webdav

A user may request a macaroon by making an HTTP POST request to the
WebDAV door. This log entry was augmented by the ID and type of
macaroon used.

A previous patch needed a bit of an update to ensure that X.509-with-FQAN authenticated third-party transfers with macaroons work under all circumstances. This is now ensured.

### xrootd

A previous patch, committed on master as 6e90136, introduced xrootd
properties to control the behaviour of the xrootd door when sending
kafka events. This patch contained a typo in the default value.
The result was dCache would not start with a kafka enabled xrootd
door. This issue has been fixed.


### Changelog 4.2.13..4.2.14

<!-- git log 4.2.13..4.2.14 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[d4eeef2c6f](https://github.com/dcache/dcache/commit/d4eeef2c6fbde634a3ad67895423d2deacc83e1a)
:   [maven-release-plugin] prepare release 4.2.14

[e3881d4517](https://github.com/dcache/dcache/commit/e3881d451766f9deeb7de700b2746d76bcfdf741)
:   xrootd: fix broken configuration property

[93adbb27cd](https://github.com/dcache/dcache/commit/93adbb27cdcb82ce29367b90527cb49e93125347)
:   Revert "packaging: use private BC 1.50 release that provides JSSE compatible handling of key agreement secret generation."

[1e99b2e16c](https://github.com/dcache/dcache/commit/1e99b2e16c76b31ec5f6a366fc39d6c149ac3ddc)
:   gplazma: support large gid values for roles

[403ffa3095](https://github.com/dcache/dcache/commit/403ffa3095d3622566cabda91ac6d8795fa5a1f6)
:   pool: P2P failures trigger stack-trace

[b7dd724b2b](https://github.com/dcache/dcache/commit/b7dd724b2bdeff260858226a47df9c57ec137b82)
:   webdav: obtain FQAN from X.509 credential for gridsite

[0c5fa778e5](https://github.com/dcache/dcache/commit/0c5fa778e5f205ef7d1b5bea8c4fcdfb40879ee2)
:   core: avoid sending bad macaroons to gplazma

[3e03f5085d](https://github.com/dcache/dcache/commit/3e03f5085dfc07a27f103295c508b0f18ecec2f4)
:   webdav: update access log to record macaroon request details

[21e168325b](https://github.com/dcache/dcache/commit/21e168325bb28d17fb4f750b260b0a7eef9472b5)
:   transfermanager: fix missing path

[f6fe0b2163](https://github.com/dcache/dcache/commit/f6fe0b2163db8d353bdaa05a95d1d27f62254e37)
:   ftp: java.lang.IllegalStateException: Cannot send after the producer is closed.

[18ebdc50a3](https://github.com/dcache/dcache/commit/18ebdc50a375f16f633478c6cc3a0cb3a391cfaf)
:   dcache: use getAddress for uniform client IPs in Transfer info

[1db446d680](https://github.com/dcache/dcache/commit/1db446d68000d7d5ba66a4af638d4f1fdad90b5e)
:   libs: update to commons-compress-1.18

[c223e0afe9](https://github.com/dcache/dcache/commit/c223e0afe98c31a120389b9dda33e94082c47cbc)
:   httpd: add path to context/transfers.json

[2ca2edc9d5](https://github.com/dcache/dcache/commit/2ca2edc9d5c3ba5fa3a825fbea8df9898e03d51e)
:   macaroons: include macaroon id in error message

[af0c14fc17](https://github.com/dcache/dcache/commit/af0c14fc17fd18430dbcdd2be18a8a89ee08eea3)
:   pool: fix pool's runtime configured size regression (b70b0d9)

[ee9685760a](https://github.com/dcache/dcache/commit/ee9685760a276c50798b1546a917dc501c92700c)
:   core: provide better feedback and logging if a macaroon is rejected

[e7416d7035](https://github.com/dcache/dcache/commit/e7416d7035951a52f510e3c7b0cdeea485aaa020)
:   dcache-frontend: fix array out of bounds exception in cell info service

[910ed77ac4](https://github.com/dcache/dcache/commit/910ed77ac497e528bd51f681a70d49369dfbceaf)
:   pool: update HTTP TPC to support retrying GET and HEAD requests for DPM

[bc15b8cfe2](https://github.com/dcache/dcache/commit/bc15b8cfe265ec408816356f371b56e630e274a1)
:   srm: add gridsite delegation interface access-log

[60f5628b02](https://github.com/dcache/dcache/commit/60f5628b02eee7377a94df62ce49108446c2928b)
:   macaroons: fix logged id

[e773fd08c2](https://github.com/dcache/dcache/commit/e773fd08c2db2442c70bec9bcbc6bc541d01506c)
:   dcache-frontend: add path filter to transfers

[8e35daa3c6](https://github.com/dcache/dcache/commit/8e35daa3c6f6e84f228545ec172e9871547f8fda)
:   core: avoid stacktrace on arbitrary CacheException

[4b4cd464b2](https://github.com/dcache/dcache/commit/4b4cd464b23f3761f1d86fbfb81591acdeb389a8)
:   [maven-release-plugin] prepare for next development iteration

[a514557a15](https://github.com/dcache/dcache/commit/a514557a154cdca896dd522c5ed2465a72617dae)
:   pnfsmanager: allow restricted user with UPLOAD to create parent directories

## Release 4.2.13

### Changes affecting multiple services

Through integration of an updated BouncyCastle cryptography library package,
some rare errors where clients would report a "pad block corrupted" error
are avoided.

### frontend

When a user does not have the permission to read a file (or is simply
not logged in), dCache would previously report a 500
Internal Server Error. This error reporting was improved,
reporting 401 Unauthorized or 403 Forbidden
as appropriate.

dCache has a hard-coded behaviour where a user providing bad
authentication (e.g., wrong password, expired OIDC access-token or
macaroon) is treated as the anonymous user.

This has proved counter-intuitive, as wrong/expired credentials often
appear to succeed for some operations (e.g., directory listing), while
failing others (upload/download).

A new configuration property,
`dcache.enable.authn.anonymous-fallback-on-failed-login`, allows
changing that behaviour. The default setting of the property
does not change system behaviour.

### ftp

If the ftp client requests a proxied passive transfer with a different
IP family from the control channel (i.e., the client connects using IPv6
and requests an IPv4 data channel, or vice versa) the ftp server must
select which IP address it should return to the client.

As pointed out by Francesco Prelz (thanks!), the door currently selects
the first address from the same interface that has the desired IP
family. However, this may not be accessible by the client.

This release updates address selection so that only usable addresses
will be returned to the clients.

### info

Clients querying the info service (such as info-provider
and storage-report) are now informed
of the number of files stored in a space reservation.

The info service now displays the time at which the information it displays
was recorded.

### nfs

Using the latest NFS4J library brings some performance improvements.

### pool

Monitoring transfers is now a bit more comfortable as this release
adds path information to a transfer's information.

### poolmanager

This release increases responsiveness for users that are not allowed to stage files, and for NFS users who access offline files.
In cases where such a user issued a read request at the same time that Pool Manager handled
a staging request, the first request would block for the duration of the staging -- potentially
quite a while. From now on, users that are not allowed to stage receive appropriate error
messages as soon as possible, without having to wait for anyone else.

### xrootd

The `--zip` option of xrootd clients is now supported.

Support for xrootd `mkdir` was improved.



### Changelog 4.2.12..4.2.13

<!-- git log 4.2.12..4.2.13 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[fcc1adcb70](https://github.com/dcache/dcache/commit/fcc1adcb70dbe3347c402b33cfa153251e686694)
:   [maven-release-plugin] prepare release 4.2.13

[5bf1013356](https://github.com/dcache/dcache/commit/5bf1013356a77925e8ea198492dad146503ef6b0)
:   xrootd: remove spurious stack-trace

[970434b225](https://github.com/dcache/dcache/commit/970434b225ebb54d426016d02d1f3ff7f4bb7ab8)
:   xrootd: add support for kXR_stat on open files

[8892290b5a](https://github.com/dcache/dcache/commit/8892290b5a476f9647d85a7e7bee299329576c5f)
:   xrootd: update to xrootd4j dependency to 3.3.3

[5c7597f335](https://github.com/dcache/dcache/commit/5c7597f335e723d5bd3b90fbea3e1167bafd643f)
:   packaging: use private BC 1.50 release that provides JSSE compatible handling of key agreement secret generation.

[1958003b5c](https://github.com/dcache/dcache/commit/1958003b5c9a767db88dcc543e3d9970c5ec72ea)
:   dcache-frontend: fix error message for IdResource

[05346f76d3](https://github.com/dcache/dcache/commit/05346f76d3f6a8c69933505f2a4382b73c37a4dd)
:   ftp: better address selection for cross-family passive proxied transfers

[9ddd28ac95](https://github.com/dcache/dcache/commit/9ddd28ac959a2960652ca209b4e372f81f978c58)
:   webdav/frontend: make anonymous fallback on bad login optional

[173de7a6bf](https://github.com/dcache/dcache/commit/173de7a6bf6ae0c9d83508a26354ea62efeed0c9)
:   info/space-manager: monitor number of files in reservation

[2bba771c56](https://github.com/dcache/dcache/commit/2bba771c56736b1107871830cddf0796c2addd74)
:   info: display the timestamps when metrics were collected

[c09d13284a](https://github.com/dcache/dcache/commit/c09d13284ae842bfac61a96532bfb717a3163447)
:   poolmanager: do not squash request if state is not allowed

[d7e1539492](https://github.com/dcache/dcache/commit/d7e1539492e99d03b1186335e4817bddab908896)
:   libs: use nfs4j-0.17.5

[4d026acdb3](https://github.com/dcache/dcache/commit/4d026acdb3e72a323d70a774dc1c0bb8dd156f40)
:   [maven-release-plugin] prepare for next development iteration

[547776f84b](https://github.com/dcache/dcache/commit/547776f84b96c19720a57933e364df2efbd56633)
:   dcache: add path to transfer information

## Release 4.2.12

### Changes affecting multiple services

For dcap and ftp dorrs for each transfer was created new Kafka producer.
As a result first Server was shutdown with the following IO exception java.io.IOException: Too many open files
This is fixed now.

The previous for mat for the `date` key in message was not easy to parse `"date":"Mon Oct 01 13:49:00 CEST 2018"`.
 This is now changed and the new
format, is `"date":"2018-10-01T13:50:30.008+02:00"` is easier to parse.


### frontend

All monitoring information was only available to admin role users.
This was a change from the previous webadmin interface, where most information
(except alarms and space token definition) had been  available to all users.
This probably was too restrictive and may disrupt some user patterns.
The current release improved the access semantics which are more compatible with previous usage.

### gplazma

The current release added gplazma2-fermi voggroup plugin supports wilcard match on user fqan.

### sysytemd

Systemd did  not inherite the system-wide limits and was  completely ignoring  `/etc/security/limits.d/92-dcache.conf`.
This is now fixed and the limits successfully loaded and enabled as expected.

### vehicles

The current release has fixed serialization regression in `FileCorruptedCacheException`.

### Changelog 4.2.11..4.2.12

<!-- git log 4.2.11..4.2.12 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[1400080](https://github.com/dcache/dcache/commit/14000806667ae387dc90f95bbba4a83445b92cba)
:   [maven-release-plugin] prepare release 4.2.12

[a47b547](https://github.com/dcache/dcache/commit/a47b5477e0626458bbee71b0b58ff65f2ba87618)
:   dcache-xrootd: add missing kafka property

[d9bb047](https://github.com/dcache/dcache/commit/d9bb047dfe92a4ab20e88ddfda42847a79def16a)
:   vehicles: fix serialization regression  in  FileCorruptedCacheException

[d7c9480](https://github.com/dcache/dcache/commit/d7c948038e22dfec487c22acf68cc2955fa4a79a)
:   Update StorageInfoMessageSerializer.java

[8c3ea5e](https://github.com/dcache/dcache/commit/8c3ea5e913da50a3da34d80aa58a98ecb1750e3d)
:   dcache: Adjust Date formating of Timestamp value for `date` key for  kafka producer

[75e5f9b](https://github.com/dcache/dcache/commit/75e5f9bdeeefe519dbb13ea86884e6672b410641)
:   dcache: Creating multiple KafkaProducer instances results in 'Too many open files'

[62624b0](https://github.com/dcache/dcache/commit/62624b06bfac03144c4121e88c50eed27e85caf8)
:   gplazma2-fermi plugin (vogroup plugin): allow for wildcard match of fqans

[b4bec04](https://github.com/dcache/dcache/commit/b4bec045c2b8fe77c3cb14bcff56d3aa064135bb)
:   dcache-frontend: remove admin restrictions on GET and filter transfers on uid if not admin

[83847a0](https://github.com/dcache/dcache/commit/83847a0d968490b4af0b4021934eadfd37476759)
:   [maven-release-plugin] prepare for next development iteration

[7218c51](https://github.com/dcache/dcache/commit/7218c51b602e7ef238ff8a01c1ff04d9ce7e5966)
:   systemd: Add `/etc/security/limits.d/92-dcache.conf` in the dcache systemd unit and generator.

## Release 4.2.11

### Changes affecting multiple services

This rlease fixes an issue with WebDAV 3rd-party-copy requests that are
authorized using a macaroon that is only valid for writing a specific file.

NOTE: both the webdav door and transfermanagers must be updated before
the fix is effective.

The timeout used by dCache when attempting to send a Kafka event is now
adjustable via the configuration properties dcache.kafka.maximum-block
and dcache.kafka.maximum-block.unit.

The default timeout for pools, and the xrootd, nfs and webdav doors is
now non-zero. This should fix the problem of kafka events being lost
under normal operational conditions.

NFS4J was updated to a newer version with two upstream bugfixes:

* compatibility with standard rpcbind clients
* allow regular users to change file's owner to the same value

### pool

In order to help with debugging issues with partial FTP transfers,
dCache pools now are able to log considerable information about failed FTP
transfers.

This is controlled by the new property `pool.mover.ftp.enable.log-aborted-transfers`.

### transfermanagers

An old table that was previously used for debugging and monitoring purposes
was removed, leading to better performance of the transfermanagers service.

### webdav

dCache can now transfer data with a remote site, authenticating with
that remote site using a delegated X.509 credential, but authenticating
locally with a macaroon.

### xrootd

This release updates xrootd4j, which should help fix occasional "pad block corrupted" issues with older clients.


### Changelog 4.2.10..4.2.11

<!-- git log 4.2.10..4.2.11 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[43f7091ce7](https://github.com/dcache/dcache/commit/43f7091ce74a40d66b5f0be32cef417709d0afcf)
:   [maven-release-plugin] prepare release 4.2.11

[818e38da53](https://github.com/dcache/dcache/commit/818e38da53ea06b4869ea368c967b33ee9527d7f)
:   pom.xml: update to xrootd4j dependency to 3.3.1

[2e991d0c5a](https://github.com/dcache/dcache/commit/2e991d0c5a01271ccb1393e7c38e8a7e1ed47ad2)
:   webdav: use TLS credential directly for gridsite

[4dea39e85d](https://github.com/dcache/dcache/commit/4dea39e85dd4475395eb770b97319c877113eaf8)
:   pool: instrument ftp mover to show partial transfers

[6faca97336](https://github.com/dcache/dcache/commit/6faca97336af62f554809b9643c1f490459cd160)
:   ftp: fix regression in unit-tests

[64db762f89](https://github.com/dcache/dcache/commit/64db762f89aeeb4b9d2604f2a86ad60f6599c2ec)
:   libs: update to nfs4j-0.17.4

[3f4e24e3b1](https://github.com/dcache/dcache/commit/3f4e24e3b14ee51169e472b9f2ea611931dd8526)
:   dcache: add configuration for the Kafka producer timeout

[69bb883d19](https://github.com/dcache/dcache/commit/69bb883d1989d825b67b9d86a74920a36da04d60)
:   TransferManager:  remove state history class and corresponding table responsible                   for storing request state changes. It is not used, but                   may grow rapidly in database.

[fe4d837004](https://github.com/dcache/dcache/commit/fe4d8370043e5b9864400b53496295ac5e2dcb7c)
:   webdav+transfermanagers: support TPC pull with targeted macaroons

[211713183e](https://github.com/dcache/dcache/commit/211713183e48f3eb623877efc0f6873cde95303d)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.10

### gplazma-role


A new  `observer` role  is defined in current release, which is a weaker role than "admin" is useful for according
read-only access to system or file information.


### Changelog 4.2.9..4.2.10

<!-- git log 4.2.9..4.2.10 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[f82cfff](https://github.com/dcache/dcache/commit/f82cfff6aa268a6e84a3bfa2950d766a8b0e715a)
:   [maven-release-plugin] prepare release 4.2.10

[047fc4c](https://github.com/dcache/dcache/commit/047fc4cc86d6c651764386dc8272f45dc7f6206a)
:   gplazma-role: add observer role

[ba8579e](https://github.com/dcache/dcache/commit/ba8579e3461e1050d5ccce7fb82291f3f20f1a76)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.9

### frontend

The current release fixed broken directory QoS reporting and now frontend now more accurately describes the QoS of directories; i.e., the
QoS that newly written files will receive when written into this
directory, assuming none of the targeted pools are volatile.

### webdav

the macaroon creation with multiple path restrictions failed with a http error 500 and the error message.
 This is now fixed and the macaroon creation succeeds when multiple path restrictions are defined.

The current release improved  error handling for PROPFIND request.


### Changelog 4.2.8..4.2.9

<!-- git log 4.2.8..4.2.9 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[114c2ca](https://github.com/dcache/dcache/commit/114c2cabe24d2a9cc5422f96212f3967cab812a2)
:   [maven-release-plugin] prepare release 4.2.9

[d47ab2b](https://github.com/dcache/dcache/commit/d47ab2be3c3d71477ed29abb07ad5d7fdcb95c28)
:   frontend: fix broken directory qos reporting

[9a6aff8](https://github.com/dcache/dcache/commit/9a6aff855e4b54d6b290669752bf5da9939ed1c1)
:   webdav: avoid throwing any exception when listing a directory for PROPFIND

[013383a](https://github.com/dcache/dcache/commit/013383ac928f034c2b29b1e07106168051bc28d3)
:   webdav/macaroon: Fix macaroon creation with multiple path restrictions.

[5506a64](https://github.com/dcache/dcache/commit/5506a644e4619bd95f39c798802f454790680100)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.8

### dcache-view

Several fixes has been implemented  for  dcache-view:  openid connect redirect handling is fixed, fixed file download.

### dcache-xroot

The current release added necessary gsi properties for tcp credentials.
These properties have to do with the third-party client on the pool.
 Note:  this is a temporary workaround for
  a problem which will be solved in a more general fashion
For more details please check `xrootd-gsi.properties`.

### ftp

dCache now has the ability to log the current status of a transfer at the point the client decided to abort an FTP transfer.
This should support a post mortem investigation on why a transfer was cancelled.

### ftp,dcap

The current release added functionality to push  billing events to Kafka Server when  `ftp.enable.kafka`  and `dcacp.enable.kafka` are enabled.

### nfs

With the current release the timeout of pnfshandler is configurable and nfs door quicker
 recovers from situations, when a PnfsManager is not available.

### poolmanager

Previously in dCache it was not possible stage files from tape. This is now fixed.


### Changelog 4.2.7..4.2.8

<!-- git log 4.2.7..4.2.8 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[bc73677](https://github.com/dcache/dcache/commit/bc73677576ffc39f1e656f7aa6f8ab97df9ef091)
:   [maven-release-plugin] prepare release 4.2.8

[2c2c3b8](https://github.com/dcache/dcache/commit/2c2c3b8b261e689deaea6de489cbc28d09381c01)
:   ftp: add ability to log client-aborted transfers

[99ac792](https://github.com/dcache/dcache/commit/99ac79209d3f7f19306d3b356ede52add6ec4c7a)
:   nfs: make timeout of pnfshandler configurable

[23f8145](https://github.com/dcache/dcache/commit/23f81457d084084b9008bfd7764b381326328d82)
:   poolmanager: fix staging files from tape

[df52050](https://github.com/dcache/dcache/commit/df52050394ad07912ebca8bc1f8a827dc9f59a4a)
:   pool: fix NullPointerException

[420d9c5](https://github.com/dcache/dcache/commit/420d9c51d504da4959c8c28fcea09d7f2f5a573d)
:   ftp: fix NullPointerException

[5875eb8](https://github.com/dcache/dcache/commit/5875eb8f08610a2181d687d31a81505eea0d5a4c)
:   dcap: clean code changes

[9a99bbe](https://github.com/dcache/dcache/commit/9a99bbeb6a74aea29491331b847c1a174741bb78)
:   ftp: add kafka to push messages

[754ebd9](https://github.com/dcache/dcache/commit/754ebd907eb14e447256a7b5a0c620a9acc29bea)
:   dcap: enable possibility to push transfer events to Kafka

[611a2b6](https://github.com/dcache/dcache/commit/611a2b6d95e9650bd1ea656dc9e9c0bdc7325776)
:   dcache: release dcache-view version 1.4.5

[329a998](https://github.com/dcache/dcache/commit/329a998a699af364461c83ef3d85b0f3e6aca6a5)
:   dcache-xrootd: add necessary gsi properties for tpc credentials

[bb27660](https://github.com/dcache/dcache/commit/bb276604e77d0fa60b70fe32fafb7cf5a704453e)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.7

### NFS

When two clients A and B operate on a file in quick succession, A opening the
file and B deleting it before LAYOUTGET is called, dCache puts the
transfer into the list of active transfers and returned NFS4ERR_NOENT. If a
client tries to optimize the corresponding CLOSE call away, as some do,
the entries are never removed from the list, effectively creating a leak.

This problem was fixed. Clients now receive an NFS4ERR_STALE message in those
cases.

### core

Certain transfer failures, such as attempting to
use a space-reservation that has insufficient capacity, resulted in the
door eventually reporting a time-out problem to the client.

A typical error message would resemble

```Request to [>SpaceManager@local ... ] timed out.```

This problem was traced to an internal misconfiguration of a messaging
component and is fixed from this release onwards.

### frontend

The reporting of a file's QoS status in frontend was improved. Files
that are being scheduled for moving to tape are now reported as
'tape' instead of 'disk'.

### pool

In some cases, storage info data was not included in messages issued during
a pool flush. This caused an irrelevant NPE to be logged.

This problem was solved, and as a side effect of the fix, billing records
now have the correct format when reporting on flushes:

```08.24 15:24:41 [pool:dcache-lab002-A@dcache-lab002Domain:store] [00006BD12E8925744156AAE87641D4AF73BB,1362] [/] 100013 2 {10006:"Flush was cancelled."}```

vs.

```8.24 15:51:07 [pool:dcache-lab002-A@dcache-lab002Domain:store] [00005C1387649DD74E0491DFE9A98D97DC39,1362] [/] data:sla2@osm 100015 1 {10006:"Flush was cancelled."}```

A bug was fixed that occasionally caused problems with the pools'
Berkeley DB. This could, for example, be triggered by removing files
which were in a flush queue.

A typical error message was, e.g.

```
27 Aug 2018 12:09:33 (cat2_lhcbtape) [Frontend-dcacheview PoolDataRequest] Fault occurred in repository: Internal repository error. Pool restart required: : CacheExcept
ion(rc=204;msg=Meta data lookup failed and a pool restart is required: (JE 7.3.7) Environment must be closed, caused by: com.sleepycat.je.ThreadInterruptedException: En
vironment invalid because of previous exception: (JE 7.3.7) /space/lhcb/tape/pool/meta java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause
incorrect internal state, unable to continue. Environment is invalid and must be closed.)
27 Aug 2018 12:09:33 (cat2_lhcbtape) [Frontend-dcacheview PoolDataRequest] Pool mode changed to disabled(fetch,store,stage,p2p-client,p2p-server,dead): Pool restart req
uired: Internal repository error
```

### webdav

Web clients (such as web-browsers) make OPTIONS pre-flight requests to
discover what they are allowed to do, according to the CORS standard.

Unfortunately, some web-browsers make the OPTIONS request without
presenting any credentials. If the resource is within a protected
directory then dCache currently fails the OPTIONS request.

This release introduces a new behaviour where such requests will always
succeed, so that browser pre-flight requests are not hampered.


### Changelog 4.2.6..4.2.7

<!-- git log 4.2.6..4.2.7 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[ea02df1ff1](https://github.com/dcache/dcache/commit/ea02df1ff17128b11490ae4ae6510697943cbfda)
:   [maven-release-plugin] prepare release 4.2.7

[bc2fd01e8c](https://github.com/dcache/dcache/commit/bc2fd01e8cc0398a107a057dcb7a7ee140092595)
:   nearline-provides: do not interrupt processing thread on cancel

[1e69881794](https://github.com/dcache/dcache/commit/1e6988179429d50fffd79c0b3485d28095482ad1)
:   nfs41: invalidate open-state on layoutget if file is removed

[b1af2ffc4f](https://github.com/dcache/dcache/commit/b1af2ffc4fb1f8c30fddce416efb4043a9650c8a)
:   pool: fix NPE on flush

[9dd5c2ac90](https://github.com/dcache/dcache/commit/9dd5c2ac9059330787dc0ed8c1529bad37cc55ab)
:   webdav: always respond to OPTIONS request

[76dad0e1de](https://github.com/dcache/dcache/commit/76dad0e1deb1f8ee619d1df838e06f2944a6c2a5)
:   core: ensure pool/poolmanager communication receives errors

[ef8da1a340](https://github.com/dcache/dcache/commit/ef8da1a340d5f00db89efb4494fc7378637ce07a)
:   frontend: add targetQoS for not-yet-flushed tape files

[b30b01fb9c](https://github.com/dcache/dcache/commit/b30b01fb9c09c287dc7e2b98501e5a3ed4f73256)
:   [maven-release-plugin] prepare for next development iteration

[121f2cf66d](https://github.com/dcache/dcache/commit/121f2cf66dbc58b6c47c5ab469549c6bfdebb527)
:   dcache: release dcache-view version 1.4.3

## Release 4.2.6

### dcache-xrootd

This release fixed  xrootd third-party transfer billing records  so that the door client is always the user connection and the billing/mover client the source or destination server.
This allows one to see immediately whether an xrootd transfer was third-party (for two-party transfers, the two clients will be identical).

### gplazma

The OidcAuthPlugin  plugin was  updated so that users whos op does not claim
 `name`, and does not claim `given_name` nor
`family_name` can use dCache.

### pool

This release fixed  the log stack-trace for `queue` admin commands and now bad admin input for the following admin commands no longer results in a stack-trace being logged:

* queue activate
* queue activate class
* queue remove class
* queue suspend class
* queue resume class
* queue remove pnfsid

### poolmanager

 NPE is fixed when staging files back from tape and
`poolmanager.enable.cache-hit-message` is true.

### webdav

The current release updated   default credential delegation for third-party copy so that now requesting a third-party copy using a macaroon does not trigger a failed
attempt to OpenID-Connect delegation.


### Changelog 4.2.5..4.2.6

<!-- git log 4.2.5..4.2.6 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[2af14c4](https://github.com/dcache/dcache/commit/2af14c43430c9ffda702c4fd52e685d6618ef79d)
:   [maven-release-plugin] prepare release 4.2.6

[611b43d](https://github.com/dcache/dcache/commit/611b43dbd22f5c43065c8c3ef1fb5c087ea77fb1)
:   poolmanager: fix NullPointerException when staging files and reporting hits

[f42afba](https://github.com/dcache/dcache/commit/f42afba5f7c404fddba2c841ffac0eadd498bebb)
:   gplazma: oidc fix FullNamePrincipal creation

[53b1b48](https://github.com/dcache/dcache/commit/53b1b48007667bad72708ff6930e0e2b97c1bf76)
:   libs: update jetty to version 9.4.11

[81f9ce5](https://github.com/dcache/dcache/commit/81f9ce5b7d5d4634e62834e01f6b6034c545eee5)
:   pool: 'queue' admin commands not the log stack-trace on bad arguments

[52e13d7](https://github.com/dcache/dcache/commit/52e13d7147c7faa8d92a4bef7daa90c47a3b90f4)
:   dcache-xrootd: fix third-party billing records

[2dd2699](https://github.com/dcache/dcache/commit/2dd2699856889cc6f3ab66f80d438e7d201544e7)
:   ftp: fix scope of used pool stub

[f1d1d94](https://github.com/dcache/dcache/commit/f1d1d943b685134eeded50f045559c6baae2de3d)
:   webdav: update default credential delegation for third-party copy

[4ffc7a5](https://github.com/dcache/dcache/commit/4ffc7a508796133ad7b8c9572ac2ba264f8adfa5)
:   srmclient: update delegation client to support X509_CERT_DIR en.var.

[7eca970](https://github.com/dcache/dcache/commit/7eca9701ec34430ba9c448e33d0c3afe86ec6260)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.5

### history

This release fixes a bug that could cause startup errors
in the history service in the face of network errors.

### many

Remote pool monitor would occasionally log stack traces from exceptions
when a domain shut down due to an interrupt. This has been fixed, reducing
the number of irrelevant log entries in such situations.

### xrootd

A small bug in a third-party client which
does not propagate errors occurring
too quickly could cause error messages to not be displayed
to the user.
 One such example would be an
auth failure due to bad configuration, which
would appear as a file size mismatch to the user.
This issue has been worked around, and all errors should
now be reported correctly.


### Changelog 4.2.4..4.2.5

<!-- git log 4.2.4..4.2.5 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[8bf8c1a5dd](https://github.com/dcache/dcache/commit/8bf8c1a5dd0cc2ef361da87d004f300867b03042)
:   [maven-release-plugin] prepare release 4.2.5

[280bb7122d](https://github.com/dcache/dcache/commit/280bb7122d5a2159a349f667042a1a985b84203c)
:   dcache-xrootd: repair handling of delayed sync errors to client

[02fbe1f2e8](https://github.com/dcache/dcache/commit/02fbe1f2e80489ba204d985c707eb9b9ea635049)
:   dcache-history: handle Gson syntax errors explicitly

[cdfab2a1f3](https://github.com/dcache/dcache/commit/cdfab2a1f30b7917924ffc5eeb3565b77d21feaa)
:   cells: add handling of RemoteProxyFailureException nested InterruptedException to UncaughtException handler

[a8439d4354](https://github.com/dcache/dcache/commit/a8439d4354325889ab3c59d7c17f56e4605f245c)
:   dcache: remove unused jndi initializers from httpd

[c633404d68](https://github.com/dcache/dcache/commit/c633404d68ebbb6577b67486f0db74eb90685775)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.4


### dcache-xrootd

The current release added support to third-party copy to and from dCache.


### Changelog 4.2.3..4.2.4

<!-- git log 4.2.3..4.2.4 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[11994c0](https://github.com/dcache/dcache/commit/11994c07f40a1b1ddbfd865cf31fe4cec2727019)
:   [maven-release-plugin] prepare release 4.2.4

[b5a1d9e](https://github.com/dcache/dcache/commit/b5a1d9ed9074fe94ee7c84f7bd4d70410e9e53c1)
:   dcache-xrootd: add support for redirect handling during third-party-copy

[a1619fa](https://github.com/dcache/dcache/commit/a1619fa378508f9ced17615fff686fa7c0216980)
:   dcache-xrootd: add third-party support to pool (dcache as destination)

[b7087ab](https://github.com/dcache/dcache/commit/b7087ab200b22a7447e979c65c7fed4ab53e9ab9)
:   dcache-xrootd: add support for third-party copy to door

[381d969](https://github.com/dcache/dcache/commit/381d969f97c8398fcbd7e479baa8ba521d1b454c)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.3

### nfs

dCache 4.2 now uses nfs4j version 0.17.3, which includes a bugfix that should
help avoid some rarely observed deadlocks with current Linux clients.


### Changelog 4.2.2..4.2.3

<!-- git log 4.2.2..4.2.3 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[94a7a8a2a9](https://github.com/dcache/dcache/commit/94a7a8a2a963b883a640e5f589db0521e19e4569)
:   [maven-release-plugin] prepare release 4.2.3

[f6508c3019](https://github.com/dcache/dcache/commit/f6508c30199c10c0c2e4b397ddd87d2a9455edc5)
:   pom: use nfs4j-0.17.3 bugfix version

[ac59cb3056](https://github.com/dcache/dcache/commit/ac59cb30564286c94ec8087959ee487565c62a8f)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.2

### PNFS

### pool

HTTP responses now contain more meaningful messages along with the
HTTP response codes, instead of only just showing stock messages
like "400 Bad request".

### webdav

When the WebDAV door proxies a transfer and a transfer failure occurs, the
door previously always just reported "500 Internal Error". This reporting
is now improved, with any more detailed error messages from (possibly)
other services taking precedence. For example, if a pool returns a 400 error code,
thus complaining about the client's request, this code is reported instead,
which should help with diagnosing the error's cause.


### Changelog 4.2.1..4.2.2

<!-- git log 4.2.1..4.2.2 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[7fdc1fab07](https://github.com/dcache/dcache/commit/7fdc1fab074bf93c280ec543d96784629ef5843d)
:   [maven-release-plugin] prepare release 4.2.2

[2fb72a7074](https://github.com/dcache/dcache/commit/2fb72a70740997bb199668f9f6702b8082e21c20)
:   webdav: pass on status message phrase to client

[f1ae38b5e1](https://github.com/dcache/dcache/commit/f1ae38b5e1fa67cd8919046a7f5785124a4dc438)
:   pool: update HTTP mover to report errors as HTTP status message phrase

[dfd2d85a11](https://github.com/dcache/dcache/commit/dfd2d85a11342364e19cd7d0eac37838250abc81)
:   admin: fix regression in startup

[7dbd5da6a2](https://github.com/dcache/dcache/commit/7dbd5da6a207a2e4dbdde44a3bfeb77163b07504)
:   pnfsmanager: fix digest name handling in `get file checksum` command

[1be5d6a26d](https://github.com/dcache/dcache/commit/1be5d6a26d1a3678fa0e25b91573c3691f690724)
:   [maven-release-plugin] prepare for next development iteration

## Release 4.2.1

### frontend

The frontend now correctly handles situations where a transfer that is already completed is killed. Be aware that in order to make use of the bugfix, both the pools and the head nodes need to be updated to at least 4.1.9.

### ftp

Since commit eefb964, 3rd-party-transfers using ftp between two dCache endpoints had an issue where connections were not reliably closed. This release fixes the problem.

### pool

This release improves dCache’s robustness against network errors: In case registering a file with PNFS manager fails due to a timeout, the request is retried transparently.

### resilience

Resilience suffered from a bug that would lead to a NoSuchElementException when a pool name no longer
mapped to a location known to the Resilience service. This issue has been fixed.

When multiple pools go offline it is possible that
all replicas for a given resilient file become unreadable.
If the file is not CUSTODIAL, and thus cannot be restored
from tape, the discovery of such a file during scanning
will generate an error in the 'history errors' listing,
in the resilience domain .resilience log, and will also
raise a general alarm concerning the pool.


There currently exists a command, 'inaccessible', which
generates a listing of the pnfsids on a given pool
which in the current state of dCache have no readable
replicas.  However, this command takes a while to complete
(asynchronously), and the output is written to a file
which must be viewed by logging in.

This release introduces 'refering pool' information to the
error output so that grepping the resilience log for a given
pool becomes easier, and adds options to the command to check
further details.

### scripts

A regression in the dcache pool convert command was fixed; the command works again.

### scriptsi

The instructions that are printed out once dcache pool convert completes successfully now correctly point to the property that needs to be updated, namely pool.plugins.meta.


### Changelog 4.2.0..4.2.1

<!-- git log 4.2.0..4.2.1 -no-merges -format='[%h](https://github.com/dcache/dcache/commit/%H)%n:   %s%n' -->

[84cef8a4fe](https://github.com/dcache/dcache/commit/84cef8a4fe4e37db7c54d1fbb83dd5e16a39a40f)
:   [maven-release-plugin] prepare release 4.2.1

[a755481da7](https://github.com/dcache/dcache/commit/a755481da795383267c0fad71c2caa6472a518bb)
:   dcache-resilience: improve inaccessible file accounting

[f399ca1f5c](https://github.com/dcache/dcache/commit/f399ca1f5c53e8e0dc825560bd3a4bb134a85a3e)
:   dcache-resilience: skip invalid cancel filters

[cd8d67ec4a](https://github.com/dcache/dcache/commit/cd8d67ec4a0c76575977ae50373f0b6d24f33043)
:   pool: fix 'dcache pool convert' command

[ecb03fa5c3](https://github.com/dcache/dcache/commit/ecb03fa5c34d6bbdbae76c88258ec5b96bd79a8a)
:   scripts: update reference to configuration property

[1664ca4f10](https://github.com/dcache/dcache/commit/1664ca4f10602cd9cefa59a328cc2d590d8e360c)
:   pool: fix metadata migration tool to use Path

[a2caabae35](https://github.com/dcache/dcache/commit/a2caabae35d44a57c79c9e5a950038853d73db32)
:   ftp: always close proxied data connection if client closes their half

[cc96591b64](https://github.com/dcache/dcache/commit/cc96591b646da9fd2bd93403d8d74620db23d57f)
:   vehicles: fail-fast on invalid path

[7bcb0d6b58](https://github.com/dcache/dcache/commit/7bcb0d6b58fbb86e103f72ac4f04f4a73218de16)
:   pool: retry request to pnfs manager if timed out

[b45f1982da](https://github.com/dcache/dcache/commit/b45f1982da940f0dbdcdc62889fe0cf2cd3b0caf)
:   dcache-frontend: invalidate transfer when killed mover not found

[7526861552](https://github.com/dcache/dcache/commit/7526861552fd918afe6285ba7f804282e391751a)
:   [maven-release-plugin] prepare for next development iteration

[20539f937e](https://github.com/dcache/dcache/commit/20539f937e2788391577f3564e66869a45c1ce15)
:   dcache-frontend: add "Requires admin role" to alarms methods (Swagger)

## Release 4.2.0

### Admin

The admin sshd server supports public key and password authentication mechanisms.
Some facilities, however, have security policies that explicitly disallow
these mechanisms.
This release adds the kerberos authentication mechanism to the admin sshd server and
introduces the ability to enable specific authentication mechanism(s) to conform to
different security policies. The following configuration variables
have been added to control the behavior:

```
admin.ssh.authn.enabled = kerberos,password,publickey
```

(password and publickey are enabled by default). If kerberos
authentication is chosen, there is a second configuration variable pointing at
the location of the keytab file on your system:

```
admin.ssh.authn.kerberos.keytab-file = /etc/krb5.keytab
```

### Frontend

The JSON returned from the RESTful admin services now sorts lists (especially
things like pool names) in natural ascending order for improved readability.
Swagger annotations for these services have been improved and regularized.
If the history service is not running, the absence of data is now handled
peacefully.  Finally, when a mover is killed via the frontend, but the
transfer has already completed, the cached entry is now correctly invalidated;
an intervening request for the mover listings from the frontend should display
any killed mover's state as "CANCELED" until it is in fact removed from the
cache during the ensuing refresh (to get this correct behavior, however,
the pools must also be updated to 4.1.9 or better).

As mentioned above, this release includes a version of dcache-view (1.4.2)
which implements the full set of admin pages.

#### Events

With this release, frontend includes a pluggable framework to support
events, plus an example plugin: metronome.

The framework uses Server-Sent Events (SSE) to deliver events.  It
also includes a management framework for creating the SSE endpoint,
discovering which kinds of events are supported, a managing which
events are of interest.

A typical client first creates _a channel_.  This is the SSE endpoint
through which the client will receive information about events.
Channels are user-specific and require authentication.  Clients should
not share channels: a connected client is disconnected if another
client connects to this channel.

Each event has some basic metadata, such as an _event type_, and some
event data.  An event type is a label that describes broadly similar
events.  All event data for events from the same event type have the
same schema, which may be queried.

Events from the SYSTEM event type are sent to all clients, but other
events are only sent if a channel is subscribed to those events.  A
_subscription_ is when the client expresses an interest in some events
being delivered to a channel.  Each subscription has a single
_selector_ which acts as a filter, describing which events should be
delivered.  The format of a selector depends on the event source and
the schema for each event source is available.

The metronome plugin allows a client to receive a regular stream of
simple text event.

Here is a simple illustration of this working.  In this example, an
X.509 credential is used.  Note that any supported authentication may
be used instead.

First, requesting a channel:

```
paul@celebrimbor:~$ curl -D- -E /tmp/x509up_u1000 -X POST https://prometheus.desy.de:3880/api/v1/events/channels/
HTTP/1.1 201 Created
Date: Tue, 26 Jun 2018 16:35:42 GMT
Server: dCache/4.3.0-SNAPSHOT
Location: https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE, PUT
Access-Control-Allow-Headers: Content-Type, Authorization, Suppress-WWW-Authenticate
Content-Length: 0

paul@celebrimbor:~$
```

The Location response header contains the channel.  The channel allows
the client to receive events:

```
paul@celebrimbor:~$ curl -E /tmp/x509up_u1000 -H 'Accept: text/event-stream' https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw
```

This command does not return, but receives events according to the
Server-Sent Events (SSE) standard.  For more details, see
https://www.w3.org/TR/eventsource/

Using a seperate terminal, we can create a subscription to start
receiving events:

```
paul@celebrimbor:~$ curl -D- -E /tmp/x509up_u1000 -X POST -H 'Content-Type: application/json' -d '{"delay": 2, "message": "event ${count}"}' https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome
HTTP/1.1 201 Created
Date: Tue, 26 Jun 2018 16:41:17 GMT
Server: dCache/4.3.0-SNAPSHOT
Location: https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome/b969ccbf-2ba0-4f93-b249-3ce9554fb3f5
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE, PUT
Access-Control-Allow-Headers: Content-Type, Authorization, Suppress-WWW-Authenticate
Content-Length: 0

paul@celebrimbor:~$
```

The JSON entity sent with the POST request is the selector for this
subscription and the URL targets the event-source: `metronome`.

The client listening for events will now begin to receive events:

```
paul@celebrimbor:~$ curl -E /tmp/x509up_u1000 -H 'Accept: text/event-stream' https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw
event: metronome
id: 0
data: {"event":"event 1","subscription":"https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome/b969ccbf-2ba0-4f93-b249-3ce9554fb3f5"}

event: metronome
id: 1
data: {"event":"event 2","subscription":"https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome/b969ccbf-2ba0-4f93-b249-3ce9554fb3f5"}

event: metronome
id: 2
data: {"event":"event 3","subscription":"https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome/b969ccbf-2ba0-4f93-b249-3ce9554fb3f5"}

event: metronome
id: 3
data: {"event":"event 4","subscription":"https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome/b969ccbf-2ba0-4f93-b249-3ce9554fb3f5"}
```

The subscription may be deleted if these events are no longer of interest.

```
paul@celebrimbor:~$ curl -D- -E /tmp/x509up_u1000 -X DELETE https://prometheus.desy.de:3880/api/v1/events/channels/AgW3_cnbrAQ8a0vjfZSwOw/subscriptions/metronome/b969ccbf-2ba0-4f93-b249-3ce9554fb3f5
HTTP/1.1 204 No Content
Date: Tue, 26 Jun 2018 16:41:51 GMT
Server: dCache/4.3.0-SNAPSHOT
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, DELETE, PUT
Access-Control-Allow-Headers: Content-Type, Authorization, Suppress-WWW-Authenticate

paul@celebrimbor:~$
```

After this, the channel will stop receiving metronome events.

A channel may have many concurrent subscriptions, even different
subscriptions from the same event source.  It is possible for a client
to discover which channels have been requested, and which
subscriptions have been made per channel.

One further point to note: a channel that does not have a client
connected for an extended period will be deleted automatically.

### FTP

The GridFTP door (by default) tries to establish data connections
directly between the client site and the pool.  Ultimately, this is
under the clients control: the client can issue commands that force
dCache to proxy data connections.

The MODE-E extension allows data to flow over multiple TCP connections
and for those connections to be reused across multiple transfers.
This makes it harder to know the current status of a FTP session's
proxy.

To help alleviated this problem, the `info` admin command now shows an
ASCII-art rendition of the current data transfers.  The door's proxy
is represented by a box, showing the door's client-facing and
pool-facing IP address and port numbers.

The corresponding remote IP address and port numbers for the pool and
the client are also shown, along with the current status of the TCP
connections using the following scheme:

| Symbol        | Meaning
|:-------------:| -------------
| `========`    | Establish
| `--<--<--`    | Half-closed (data flowing to the left)
| `-->-->--`    | Half-closed (data flowing to the right)
| `........`    | Closed

Here is an example, showing the status half-way through transferring a
file with `globus-url-copy` using the options `-no-g2 -p 5`

```
[prometheus] (GFTP-prometheus-AAVvh9jceUg@dCacheDomain) admin > info
     User Host  : 131.169.214.58
          User  : paul
[...]
    Proxy status:
              Client        +---------------------Adapter---------------------+        Pool
131.169.214.58:39233========| 131.169.5.149:21218         131.169.5.149:37083 |========131.169.5.149:40000
131.169.214.58:39237========| 131.169.5.149:21218                             |
131.169.214.58:39236========| 131.169.5.149:21218                             |
131.169.214.58:39234========| 131.169.5.149:21218                             |
131.169.214.58:39235========| 131.169.5.149:21218                             |
                            +-------------------------------------------------+
TCP states: "========" means Established
GFTP-prometheus-AAVvh9jceUg@dCacheDoma[...]Receiving;12982;

[prometheus] (GFTP-prometheus-AAVvh9jceUg@dCacheDomain) admin >
```

### NFS

For situations where transfers stay in pending state in the nfs door, two new admin commands
are added that allow telling doors to 'forget' the transfer or retry it:

```
 transfer retry
 transfer forget
```

Such situations can be result of network errors or when
cell communicatioin tunnels get restarted due to core domain restart.

Some deployments may have quite a busy export nfs file. To make it more manageable, starting with
release 4.2, dCache supports reading multiple export files from an exports.d directory.
The configuration property ```nfs.export.dir``` controls the location of the
directory. By default, **/etc/exports.d** is used. Only files ending in .exports are considered.
Files beginning with a dot are considered hidden and ignored.

### PNFS Manager

The internal pnfsid <=> inumber cache can be configured to run in the cluster mode, e.g. multiple PnfsManagers
can share the same cache.  However, as this functionality is not required by current release cluster
configuration is not enabled.

### Poolmanager

The `psu remove pool` command now supports globbing, i.e. wildcard
characters can be used to refer to a set of pools to act upon:
```
psu remove pool dcache-pool-A*
```

### Resilience

Three issues of some importance have been addressed.

First, Resilience no longer will (incorrectly) report on non-resilient
files which have been corrupted.

Second, the computation of the number of copies needed when a storage
requirement changes was fixed so that it is now possible to go from N to M
and have resilience react correctly (by removing all but M; in particular,
the case where M = 1 was not being handled at all).

Finally, in connection with the latter, the default 'required' value on storage
units has been changed from 1 to undefined.  The only resulting behavioral change
is that resilience will now completely ignore files with the default storage
unit tag rather than alarming when no copies are readable.  '-required=1' is
different in that resilience will instead raise an alarm if the single copy
is not accessible.  This change creates a clearer distinction between
resilient and non-resilient files.

### WebDAV

Milton's behaviour in handling http OPTION method now correspond with Apache httpd
server. This ensure a proper response especially when OPTION request targets an
entity that does not exist - like in the case of uploading a file through a browser
client like dcache-view.

dCache WebDAV now support RFC 3230 clients that request digests using multiple HTTP
headers. Hence, dCache now accept and process multiple 'Want-Digest' headers.

### XRootD

Since 4.1.0 Apache-Kafka has been introduced as a possibility to publish Billing messages to Kafka.
When Kafka enabled these events could be consumed outside from dCache.
Similarly  to 4.1.0 in  4.2.0 Kafka could be enabled for xrootD by setting the folowing properties:

`xrootD.enable.kafka` controls whether the Kafka messaging system is used for message deliver.
`xrootD.enable.kafka = true|false` `xrootD.kafka.bootstrap-servers= host1:port,host2:port`.



### Changelog from 4.1.0 to 4.2.0

[7f02ae6bee](https://github.com/dcache/dcache/commit/7f02ae6bee2418173bac54cde23cbc21777abf96)
:   [maven-release-plugin] prepare branch 4.2

[ee8f1148ce](https://github.com/dcache/dcache/commit/ee8f1148ce7597c7687a35f766652bb2470fd908)
:   no longer disable Java ECC algorithms

[2cad93e4ed](https://github.com/dcache/dcache/commit/2cad93e4ed8f924a9bcbf38fae775e3d508fd7eb)
:   webdav: do not return 404 for OPTIONS request targeting absent entity

[e4b9f72b38](https://github.com/dcache/dcache/commit/e4b9f72b3896179614f189bbe4c1d5e9425cf09e)
:   dcache: release dcache-view version 1.4.2

[e90398f905](https://github.com/dcache/dcache/commit/e90398f9050a403292af39b502f3e22ebeab7fc9)
:   core: support MIME discovery from more file extensions

[89f105964f](https://github.com/dcache/dcache/commit/89f105964f23857206949255fb5d41d7d1cd1238)
:   scripts: fix port listing for httpd service

[ebb8633498](https://github.com/dcache/dcache/commit/ebb8633498cc169bb53743ddff8a6e87876010ec)
:   docs: add dcache-bird into project source tree

[e2b5adc2fd](https://github.com/dcache/dcache/commit/e2b5adc2fde3c070f90ec043ce15e9f619e58cf8)
:   libs: update nfs4j-0.17.2

[0958835ac4](https://github.com/dcache/dcache/commit/0958835ac4a4c9079c865cbb5c482b66616a8ccb)
:   frontend: use ThreadLocal to record user identity information

[cf39525a1a](https://github.com/dcache/dcache/commit/cf39525a1a9816fbdb33b2c366b80e43909bd925)
:   pom: update to nfs4j-0.17.1

[0a14ac7756](https://github.com/dcache/dcache/commit/0a14ac7756ebfdf75b61b3fb8faf6982d817e174)
:   skel: replaced dead links to antlr documentation

[df6498e339](https://github.com/dcache/dcache/commit/df6498e3399a0c6bf7a0bf23b77c2c66d6f601d7)
:   nfs: add support for exports.d directory

[b08d2e4fb0](https://github.com/dcache/dcache/commit/b08d2e4fb081ed312ec4f17816622ef69ca748ad)
:   libs: update to nfs4j-0.17.x

[0038b882e1](https://github.com/dcache/dcache/commit/0038b882e15923ea31e444f3ec36975edea06e0c)
:   dcache: setter chanegd to public

[7e1e56b08e](https://github.com/dcache/dcache/commit/7e1e56b08ece2fd674e9d64af45de0c377f9eac4)
:   pool: record events when writing/deleting files

[db7d9a07de](https://github.com/dcache/dcache/commit/db7d9a07de8199dd8dea9a364b88fdd2cfd48201)
:   xrootd: integrate Kafka to xrootdDoor

[da7f2f46ff](https://github.com/dcache/dcache/commit/da7f2f46ff022c28d8899384182561bcc9383b87)
:   pool: fix logging of replica-store on start-up

[af60a09f96](https://github.com/dcache/dcache/commit/af60a09f96e7d63f21ba22a93e4a9664c51b0730)
:   hazelcast: don't phone home

[212a8165d5](https://github.com/dcache/dcache/commit/212a8165d5df4ebd2a996d05152f24ebcf27acb5)
:   frontend: update and refactor the metronome plugin

[5c389dad6d](https://github.com/dcache/dcache/commit/5c389dad6dc1cc50e8d3bf4bf873ae9989c81427)
:   frontend: send notification to identify cause of disconnect

[eb202e3a49](https://github.com/dcache/dcache/commit/eb202e3a494bf3a8cfae47e6d2be2092890a51ba)
:   frontend: avoid deadlock

[f230aa4c75](https://github.com/dcache/dcache/commit/f230aa4c756ce52f8a8754232fc7be42cf4bd764)
:   frontend: add subscription change notification

[b1fc60ba01](https://github.com/dcache/dcache/commit/b1fc60ba01a9306f308bff13d9b554caa5f3c21e)
:   frontend: avoid resource leak when loading JSON

[ece1ce1576](https://github.com/dcache/dcache/commit/ece1ce1576eef4df6552cc7309f294d790e48b5b)
:   frontend: drop support for SSE keep-alive

[1c962917d5](https://github.com/dcache/dcache/commit/1c962917d523c41331400268d37d74cf31614c90)
:   frontend: disable support for compressed output

[eaaa430dec](https://github.com/dcache/dcache/commit/eaaa430decb8acb94c4745758e82e53f17092079)
:   nfs: create write movers for NEW file only

[822c6f19f3](https://github.com/dcache/dcache/commit/822c6f19f3b400d1e48cb5c468e71090f0565593)
:   libs: update Zookeeper to version 3.4.12

[6cbe61f37f](https://github.com/dcache/dcache/commit/6cbe61f37f32dc0a0f8862429f7bbbb03c7a65c9)
:   frontend: add generic support for events

[510b5222ac](https://github.com/dcache/dcache/commit/510b5222ac95d7d56d61a51a71d2934629c59b38)
:   core: update NameSpaceProvider#getParentOf to include name of target in parent

[e47c9abd71](https://github.com/dcache/dcache/commit/e47c9abd715b3eec84980acee5f9cc0510dc63c6)
:   chimera: extend getParentOf to include the name of the entry

[b3f90f2508](https://github.com/dcache/dcache/commit/b3f90f2508e94b94bbbde31490bcbc5580f06451)
:   pool: disallow enabling pool while its repository is loading

[9161b20422](https://github.com/dcache/dcache/commit/9161b20422acecbedcf822315eb35331239f1dcf)
:   webdav: fix java.lang.ClassCastException: error

[2781a1624a](https://github.com/dcache/dcache/commit/2781a1624ae18fd914a3f13753a811597027d10a)
:   dcache: release dcache-view version 1.4.1

[3bbe49e032](https://github.com/dcache/dcache/commit/3bbe49e03282b305ab7e2bae5fa4774294254bd9)
:   docker: Add a way to create docker image

[5bf34c5a7e](https://github.com/dcache/dcache/commit/5bf34c5a7e63b8b64dfdb3b893ed79f3adda2434)
:   chimera: ensure that we call JdbcFs#close to shutdown hazelcast

[f17bafb07b](https://github.com/dcache/dcache/commit/f17bafb07bdc7c1fb058fc3cbc4179f82b12354c)
:   pool: fix handling file-not-found in migration module

[a547e03625](https://github.com/dcache/dcache/commit/a547e03625447f8c48b2b727d5faf404b128e94d)
:   chimera: use hazelcast cache for pnfs id to inumber mapping

[ad4f22bbb4](https://github.com/dcache/dcache/commit/ad4f22bbb4cde64071fe4a39fd48b75b07210191)
:   webdav: add kafka to webdavdoor

[8282a79424](https://github.com/dcache/dcache/commit/8282a79424b66cac159c2ee2a814495551c66aeb)
:   kafka: add common LoginPrudicerListener for Kafka integration

[a48462f253](https://github.com/dcache/dcache/commit/a48462f2537b1be8dc21e41cfebac079c8a2bc3f)
:   scripts: add support for parsing ZooKeeper transaction logs

[5c96cc5bf7](https://github.com/dcache/dcache/commit/5c96cc5bf7de09842e2b630e8317c495de5bea95)
:   ftp: log failures to wrap/encrypt responses

[1bb68a8ade](https://github.com/dcache/dcache/commit/1bb68a8ade78499e3c446654b435c13142a68fac)
:   general: remove unnecessary getCharset calls

[2ff49b600c](https://github.com/dcache/dcache/commit/2ff49b600c5f7e24148596a8a70f26af0bdd12ea)
:   poolmanager: encapsulate assumptions into Pool

[7487d0a90a](https://github.com/dcache/dcache/commit/7487d0a90ae46c280eae4992735d8fd2fd319966)
:   nfs: fix invalid types in equals (regression in a11ec8d76b)

[7a287eed31](https://github.com/dcache/dcache/commit/7a287eed312a0d6c347eb4171427080c21ff4bd1)
:   nfs: don't use org.dcache.utils.Bytes#fromHexString

[249ae6c90a](https://github.com/dcache/dcache/commit/249ae6c90a4d58ed19bf6c540d0f2aeeba40d80b)
:   dcache-resilience: restore accidentally removed initialization of final field

[26b0c09b61](https://github.com/dcache/dcache/commit/26b0c09b61d5d4deb5e29093dd405c3ffbacb441)
:   dcache-resilience: eliminate unnecessary SelectionAction enum*

[4f2bd5f714](https://github.com/dcache/dcache/commit/4f2bd5f7143fda711137743614ad86efa7ef5854)
:   dcache-resilience: eliminate dead/unused code

[f57d7f7cf1](https://github.com/dcache/dcache/commit/f57d7f7cf1c0e563e571c971c7f6b5c31146403b)
:   dcache-resilience: modify storage unit resilience requirement definition

[410ed2a744](https://github.com/dcache/dcache/commit/410ed2a7441497f969267f664e3e99f46c6f0666)
:   dcache-resilience: fix computation of operation count when storage requirements change

[b7c068720a](https://github.com/dcache/dcache/commit/b7c068720a4ee42dba3f11f28574d34ebd16631c)
:   webdav, pool: handle https redirects

[0ac1251716](https://github.com/dcache/dcache/commit/0ac1251716138ca6080336ca8008134d52b064c9)
:   webdav: log errors if OIDC delegation fails

[f5c48ef709](https://github.com/dcache/dcache/commit/f5c48ef7099ed5c48bd4765885e3a6e689e65de6)
:   vehicles: use PnfsGetFileAttributes when resolving a path to PnfsId

[7822fd9165](https://github.com/dcache/dcache/commit/7822fd916552cfd9dd25ec49c0c10f7bef4714f3)
:   ftp: returned error is too vague for meaningful investigation

[549e54b36a](https://github.com/dcache/dcache/commit/549e54b36ae093fc0192f37582a04c6d6e3cc3df)
:   core: fix NPE in Transfer#getIoDoorEntry

[f0fe914599](https://github.com/dcache/dcache/commit/f0fe9145993e4fdc22303e51783d5a454769d656)
:   psu: replace Map#get+Map#put with Map#putIfAbsent

[d3115af6e4](https://github.com/dcache/dcache/commit/d3115af6e4a5db1896782bf1accb7830d667a098)
:   poolmanager: convert Unit type into enum

[aec4ee7657](https://github.com/dcache/dcache/commit/aec4ee76572e012554ca35e27772edeff63a9fb0)
:   nfs: update NFSTransfer to return an array of mirror servers

[efd60b5e96](https://github.com/dcache/dcache/commit/efd60b5e96c8dd67a95f7d8196b3c0829a0fde0b)
:   frontend: add swagger Tag descriptions

[bf2b3c38ae](https://github.com/dcache/dcache/commit/bf2b3c38ae992937dc66b3b57d21dd0ceb38c8ce)
:   nfs: add commands to reactivate stale transfers

[2b56c0f782](https://github.com/dcache/dcache/commit/2b56c0f7829691330270cb501375a8c0552117ac)
:   fix broken commit

[4e135acdad](https://github.com/dcache/dcache/commit/4e135acdadeff62b5c4404bd9a1cf865e771dda7)
:   test: fix broken commit a11ec8d76b

[72f0f8070d](https://github.com/dcache/dcache/commit/72f0f8070dbe0bd113c08283650f5902cdb811e6)
:   vehicles: remove PnfsSetChecksumMessage message

[a11ec8d76b](https://github.com/dcache/dcache/commit/a11ec8d76b549e3e1de948e2848d73d86725029e)
:   vehicles: introduce Pool class to glue pool name and address

[887d8d5738](https://github.com/dcache/dcache/commit/887d8d5738c6e2c554af8cd14e9ff8028b5e0573)
:   poolmanager: use Optional to store pool selection on stage retry

[39d6a6e1cd](https://github.com/dcache/dcache/commit/39d6a6e1cdd1e0fe43acfd8337ff727ed141ec1f)
:   poolmanager: fix migration command if named pool is removed

[e688302c92](https://github.com/dcache/dcache/commit/e688302c9231e175abf80b9e31970d88e7609248)
:   dcache-resilience: repair over-aggressive handling of broken file messages

[195733d197](https://github.com/dcache/dcache/commit/195733d1976435844654d100fb061eafd6595477)
:   ftp: improve proxy logging to facilitate debugging

[74c3fe225c](https://github.com/dcache/dcache/commit/74c3fe225c1a52dba4beadf9043785e9582cb514)
:   pool: fix error message for failed active FTP transfers

[2a2fd1196e](https://github.com/dcache/dcache/commit/2a2fd1196eac345212f0012bb9eeca622f44014e)
:   cells: remove extra synchronized block in CellMessageDispatcher#findReceivers

[3da722c9ee](https://github.com/dcache/dcache/commit/3da722c9ee56aa9c1ae02963a4d99f78114e5a9e)
:   gplazma-fermi: fix last modified check in junit test

[0d52220359](https://github.com/dcache/dcache/commit/0d5222035923545b855b5fcd5a4c427b52352e1c)
:   pool: fix data handling to use boolean rather than an enum masquerade

[b87180235f](https://github.com/dcache/dcache/commit/b87180235f5f445ad668da8f558ef2056f5e52b0)
:   spacemanager: add remote pool monitor debug logging

[1efab08893](https://github.com/dcache/dcache/commit/1efab08893b555bcae97e108387a2ef3ffe2279d)
:   ftp: avoid NPE if connection is closed.

[d7c82153e8](https://github.com/dcache/dcache/commit/d7c82153e8d4b8d5bc812679528fe890f15b5a52)
:   ftp: add detailed information about proxy status

[23d68c20e8](https://github.com/dcache/dcache/commit/23d68c20e86422e8130edd6a2e8c3ec3d241ad00)
:   core: don't use Subject#toString in IoDoorEntry

[3cebeace5f](https://github.com/dcache/dcache/commit/3cebeace5fcaf7331ef0e7f244efd6c96f7fb37c)
:   pom: enable deprecation warning at compile time

[c17d74d9cd](https://github.com/dcache/dcache/commit/c17d74d9cd474c21a17a8386a663d1b13354fb27)
:   libs: update guava and  slf4j dependencies

[2c5b2c515b](https://github.com/dcache/dcache/commit/2c5b2c515b4681382b674ad5495df7fdb0030bf1)
:   gplazma-fermi: add mapping plugin to support VO group and username from file

[b18b4775ed](https://github.com/dcache/dcache/commit/b18b4775ed5b64b97ebadc4b246dee5885f31a8d)
:   nfs: filter out IPv6 DS addresses if client connected with v4

[1f977edebd](https://github.com/dcache/dcache/commit/1f977edebd73e471d3002e812b967f3124f0a703)
:   chimera: adjust postgres driver provider to new version schema

[9ea80c230a](https://github.com/dcache/dcache/commit/9ea80c230a22019b8269f1b463780d2d6e496289)
:   dcache-webadmin: remove

[64300b79f6](https://github.com/dcache/dcache/commit/64300b79f67f47967d181ef67fd80cc7361530e9)
:   pom: use nfs4j-0.16.1

[6e25ce6d9a](https://github.com/dcache/dcache/commit/6e25ce6d9a87513d244a586e412989e7d1399615)
:   skel: remove extraneous cell-info dir

[7385ae03cf](https://github.com/dcache/dcache/commit/7385ae03cfd8d301b146b98777a1645ee11fd6ed)
:   packaging: add missing chown and chmod on pool-history

[fb4b738683](https://github.com/dcache/dcache/commit/fb4b7386832b7c967d80c798f8d15c0fe12e17b3)
:   skel: make deprecated alarms properties forbidden

[ad8a9ad724](https://github.com/dcache/dcache/commit/ad8a9ad724c3eef990c9dc19a34a477e9494d97a)
:   dcache-frontend: revise Swagger annotations

[10160be4cd](https://github.com/dcache/dcache/commit/10160be4cdc2944ce31f47c99861d8c09a2b6d09)
:   dcache: release dcache-view version 1.4.0

[9f68dbaeef](https://github.com/dcache/dcache/commit/9f68dbaeef007f63eab275971c82dd09f33cbb80)
:   webdav: support multiple RFC 3230 'Want-Digest' headers

[9280e4d658](https://github.com/dcache/dcache/commit/9280e4d658e1abfcc822cf9332937a105ce5a500)
:   ftp: ensure half-closed connections are fully closed on return

[c7af0ada5d](https://github.com/dcache/dcache/commit/c7af0ada5d6d6b9e6551019e1e7a260b7dd2ba8b)
:   ftp: close pool connection with MODE-E proxy

[a379c4ca7b](https://github.com/dcache/dcache/commit/a379c4ca7b014ff2d5c5243e727281903b333d1a)
:   psu: add glob support for 'psu remove pool' command

[17f2e54425](https://github.com/dcache/dcache/commit/17f2e544256e33e6025eb51acd29ebcca788ed09)
:   dcache-frontend: avoid null dereferencing for incomplete pool history data

[f9e4fbef43](https://github.com/dcache/dcache/commit/f9e4fbef43feabf01e5579291faed9c17097087b)
:   dcache: avoid NPE from initialization race in RestoreRequestsReceiver in HttpPooMgrEngineV3

[22aa094bcc](https://github.com/dcache/dcache/commit/22aa094bccbf65c07991db42365605c6cbe80b7f)
:   [maven-release-plugin] prepare for next development iteration




</div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
        integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

